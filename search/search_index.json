{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"\u6d59\u6c5f\u5927\u5b6625\u5e74\u6625\u590f\u7cfb\u7edf\u5b89\u5168\u5b9e\u9a8c","text":"<p>\u672c\u4ed3\u5e93\u662f\u6d59\u6c5f\u5927\u5b6625\u5e74\u6625\u590f\u7cfb\u7edf\u5b89\u5168\u8bfe\u7a0b\u7684\u6559\u5b66\u4ed3\u5e93\uff0c\u5305\u542b\u5728\u7cfb\u7edf\u5b89\u5168\u8bfe\u7a0b\u4e0a\u6240\u6709\u7684\u5b9e\u9a8c\u6587\u6863\u548c\u516c\u5f00\u4ee3\u7801\u3002\u4ed3\u5e93\u76ee\u5f55\u7ed3\u6784\uff1a</p> <pre><code>\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 docs/       # \u5b9e\u9a8c\u6587\u6863\n\u2514\u2500\u2500 mkdocs.yml\n</code></pre> <p>\u5b9e\u9a8c\u6587\u6863\u5df2\u7ecf\u90e8\u7f72\u5728\u4e86github pages\u4e0a\uff0c\u65b9\u4fbf\u5927\u5bb6\u9605\u8bfb\u3002</p>"},{"location":"lab1/","title":"Linux\u5185\u6838\u6f0f\u6d1e\u653b\u9632 - ROP\u653b\u51fb\u4e0e\u9632\u62a4","text":""},{"location":"lab1/#1","title":"1. \u5b9e\u9a8c\u76ee\u7684","text":"<ul> <li>\u4e86\u89e3 ARM64 \u6808\u7684\u5e03\u5c40\uff0c\u5b66\u4e60 buffer overflow \u6f0f\u6d1e\u7684\u539f\u7406\u4e0e\u5229\u7528\u65b9\u5f0f</li> <li>\u4e86\u89e3 stack canary \u4e0e KASLR \u7b49\u62b5\u5fa1 buffer overflow \u6f0f\u6d1e\u7684\u539f\u7406\uff0c\u5e76\u5b66\u4f1a\u5982\u4f55\u7ed5\u8fc7\u8fd9\u4e9b\u9632\u62a4\u673a\u5236</li> <li>\u5b66\u4e60 return-oriented programming (ROP) \u653b\u51fb\u539f\u7406\uff0c\u83b7\u53d6 Linux \u5185\u6838\u7684 root \u6743\u9650</li> <li>\u5b66\u4e60 ARMV8.3 PA (Pointer Authentication)\u539f\u7406\uff0c\u4e86\u89e3 Linux \u5185\u6838\u5982\u4f55\u5229\u7528 PA \u673a\u5236\u9632\u6b62 ROP \u653b\u51fb</li> </ul>"},{"location":"lab1/#2","title":"2.\u5b9e\u9a8c\u5de5\u5177","text":"<ul> <li>qemu-system-aarch64</li> <li>gdb-multiarch</li> <li>aarch64-linux-gnu-objdump</li> <li>aarch64-linux-gnu-gcc</li> </ul>"},{"location":"lab1/#3","title":"3. \u80cc\u666f\u4ecb\u7ecd","text":""},{"location":"lab1/#31-arm64","title":"3.1 ARM64 \u6c47\u7f16","text":"<p>ARM64 \u652f\u6301 EL0-EL3 \u56db\u4e2a\u7279\u6743\u7ea7\uff0cEL0 \u7279\u6743\u7ea7\u6700\u4f4e\uff0cEL3 \u6700\u9ad8\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0cEL1 \u8fd0\u884c Linux \u5185\u6838\uff0cEL0 \u8fd0\u884c\u7528\u6237\u6001\u7a0b\u5e8f\u3002</p>"},{"location":"lab1/#arm64","title":"ARM64 \u5bc4\u5b58\u5668","text":"<ul> <li>31\u4e2a\u901a\u7528\u5bc4\u5b58\u5668\uff0c\u6bcf\u4e2a\u5bc4\u5b58\u5668\u90fd\u4e3a 64bit \u5927\u5c0f\uff0c\u53ef\u4ee5\u901a\u8fc7 x0-x30 \u8bbf\u95ee\uff0c\u540c\u65f6\u53ef\u4ee5\u901a\u8fc7 w0-w30 \u6765\u8bbf\u95ee\u8fd9\u4e9b\u5bc4\u5b58\u5668\u7684\u4f4e32\u4f4d\u3002\u5176\u4e2d\uff0cx29\u5bc4\u5b58\u5668(fp)\u7528\u4e8e\u4fdd\u5b58\u6808\u5e27\u57fa\u5730\u5740\uff0cx30\u5bc4\u5b58\u5668\u4e5f\u53eblink register\uff08lr\uff09\uff0c\u7528\u4e8e\u4fdd\u5b58\u8fd4\u56de\u4e0a\u4e00\u4e2a\u51fd\u6570\u7684\u8fd4\u56de\u5730\u5740\u3002</li> <li>XZR\uff08\u503c\u59cb\u7ec8\u4e3a0\uff0cWZR \u5bf9\u5e9432\u4f4d\u96f6\u5bc4\u5b58\u5668\uff09\uff0cSP\uff08\u6808\u6307\u9488\uff09\uff0cPC\uff08\u7a0b\u5e8f\u8ba1\u6570\u5668\uff09\u3002\u5176\u4e2d\uff0cSP \u4e3a\u903b\u8f91\u5bc4\u5b58\u5668\uff0c\u4f1a\u6620\u5c04\u5230 SP_ELx \uff080 &lt;= x &lt;= 3\uff09\u56db\u4e2a\u5bc4\u5b58\u5668\u4e0a\u3002\u6839\u636e PSTATE.SPSel \u51b3\u5b9a\u5f53\u524d\u4f7f\u7528\u7684\u7269\u7406\u5bc4\u5b58\u5668\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u7528\u6237\u6001\u7a0b\u5e8f\u4f4d\u4e8eEL0\uff0c\u4f7f\u7528 SP_EL0\uff1b\u5185\u6838\u4f4d\u4e8e EL1\uff0c\u4f7f\u7528 SP_EL1\u3002</li> <li>PSTATE\uff0cSP_ELx \u7b49\u7cfb\u7edf\u5bc4\u5b58\u5668\u3002</li> </ul> <p>\u26a0\ufe0f \u6ce8\u610f \u54ea\u4e9b\u5bc4\u5b58\u5668\u662f\u5728\u4e00\u4e2a\u51fd\u6570\u4e2d\u53ef\u4ee5\u88ab\u968f\u610f\u6539\u5199\u7684\uff0c\u54ea\u4e9b\u662f\u9700\u8981\u4fdd\u5b58\u5230\u6808\u4e0a\u4e4b\u540e\u624d\u80fd\u6539\u5199\u7684</p> <p></p>"},{"location":"lab1/#arm64_1","title":"ARM64 \u6307\u4ee4","text":"<ul> <li>mov \u6307\u4ee4\u3002\u5c06\u6570\u636e\u4ece\u4e00\u4e2a\u5bc4\u5b58\u5668\u79fb\u52a8\u5230\u53e6\u4e00\u4e2a\u5bc4\u5b58\u5668\uff0c\u6216\u8005\u5c06\u4e00\u4e2a\u7acb\u5373\u6570\u52a0\u8f7d\u5230\u5bc4\u5b58\u5668\u3002</li> </ul> <pre><code>mov x1, 8   // x1 = 8\nmov x2, x1  // x2 = x1\n</code></pre> <ul> <li>\u6570\u636e\u5904\u7406\u6307\u4ee4\uff0c\u5982 add, sub, and, or \u7b49\u3002</li> </ul> <pre><code>add x1, x8, x9              // x1 = x8 + x9\nadd x8, x9, #0x30           // x8 = x9 + 0x30\nadd x19, x24, x20, lsl #3   // x19 = x24 + x20 &lt;&lt; 3\n</code></pre> <ul> <li>\u8bbf\u5b58\u4e0e\u5bfb\u5740\u6307\u4ee4</li> </ul> <pre><code>str x0, [sp, #104]              // *(sp + 104) = x0 \nstr x2, [x1, #4]!               // x1 = x1 + 4, *(x1) = x2 (\u6ce8\u610f\u5199\u5165\u5730\u5740\u4e3a\u52a0\u4e0a4\u540e\u7684x1)\nstp x0, x1, [sp]                // *(sp) = x0, *(sp + 8) = x1\n\nldr x19, [x19, #40]             // x19 = *(x19 + 40)\nldr x20, [x21, x19, lsl #3]     // x20 = *(x21 + x19 &lt;&lt; 3)\nldp x29, x30, [sp], #352        // x29 = [sp], x30 = [sp + 8], sp = sp + 352\n\nadrp x0, ffff800011c44000 &lt;init_task+0xb40&gt;  // x0 = 0xffff800011c44000\uff0c\u6ce8\u610f\u4ec5\u4ec5\u83b7\u53d6\u5730\u5740\uff0c\u4e0d\u5b9e\u9645\u8fdb\u884c\u8bbf\u5b58\u64cd\u4f5c\n</code></pre> <ul> <li>\u6bd4\u8f83\u4e0e\u8df3\u8f6c\u6307\u4ee4</li> </ul> <pre><code>b ffff800010013860 &lt;user_enable_single_step+0x38&gt;       // \u65e0\u6761\u4ef6\u8df3\u8f6c\ncbz x19, ffff80001001399c &lt;ret_from_fork+0x10&gt;          // \u6761\u4ef6\u8df3\u8f6c\uff0c\u82e5 x19 == 0 \u5219\u8df3\u8f6c\u52300xffff80001001399c\n\ncmp w0, w3                                                        // \u6bd4\u8f83 w0 \u4e0e w3 \u5bc4\u5b58\u5668\uff0c\u8be5\u6307\u4ee4\u8fdb\u884cw0 - w3\u8fd0\u7b97\uff0c\u6839\u636e\u8fd0\u7b97\u7ed3\u679c\uff0c\u8bbe\u7f6e PSTATE \u4e2d\u7684N\u4f4d\uff08\u7ed3\u679c\u4e3a\u8d1f\uff09\u6216\u8005Z\u4f4d\uff08\u7ed3\u679c\u4e3a0\uff09\nb.eq    ffff800010013b80 &lt;find_supported_vector_length+0x78&gt;      // \u6761\u4ef6\u8df3\u8f6c\uff0c\u5982\u679c PSTATE \u4e2d\u7684Z\u4f4d\u4e3a1,\u90a3\u4e48\u8df3\u8f6c\n</code></pre> <ul> <li> <p>\u51fd\u6570\u8c03\u7528\u4e0e\u8fd4\u56de\u6307\u4ee4</p> </li> <li> <p>bl \u6307\u4ee4\u5c06 PC + 4 \u5199\u5165x30\uff0c\u5e76\u8df3\u8f6c\u5230\u76ee\u6807\u51fd\u6570\uff08\u76f4\u63a5\u8df3\u8f6c\uff09</p> </li> <li>blr \u6307\u4ee4\u5c06 PC + 4 \u5199\u5165x30\uff0c\u5e76\u8df3\u8f6c\u5230\u76ee\u6807\u51fd\u6570\uff0c\u8df3\u8f6c\u4f4d\u7f6e\u7531\u5bc4\u5b58\u5668\u6307\u5b9a\uff08\u95f4\u63a5\u8df3\u8f6c\uff09</li> <li>ret \u6307\u4ee4\u5c06 x30(lr) \u5bc4\u5b58\u5668\u5199\u5165 PC\uff0c\u8df3\u8f6c\u5230 caller \u7684\u4e0b\u4e00\u6761\u6307\u4ee4\u4f4d\u7f6e</li> </ul> <pre><code>bl ffff800010deeab8 &lt;asm_exit_to_user_mode&gt;\nblr x1\nret\n</code></pre> <ul> <li>mrs/msr \u6307\u4ee4   ARM64 \u4e0d\u5141\u8bb8\u901a\u8fc7mov\u6307\u4ee4\u6765\u8bfb\u5199\u7cfb\u7edf\u5bc4\u5b58\u5668\uff0c\u53ea\u80fd\u4f7f\u7528 mrs \u548c msr \u6307\u4ee4\u3002</li> </ul> <pre><code>mrs x20, sp_el0         // sp_el0 \u7684\u503c\u62f7\u8d1d\u5230 x20\nmsr mdscr_el1, x20      // x20 \u7684\u503c\u62f7\u8d1d\u5230 mdscr_el1\n</code></pre>"},{"location":"lab1/#32-arm64-stack-layout","title":"3.2 ARM64 Stack Layout","text":"<p>\u6bcf\u4e00\u6b21\u51fd\u6570\u7684\u8c03\u7528\u90fd\u4f1a\u5728\u6808\u4e0a\u7ef4\u62a4\u4e00\u4e2a\u6808\u5e27\uff0c\u4fdd\u5b58\u8be5\u51fd\u6570\u8c03\u7528\u7684\u4fe1\u606f\u3002\u4e0b\u9762\u7684\u56fe\u5c55\u793a\u4e86 ARM64 \u67b6\u6784\u4e2d\u6808\u7684\u5e03\u5c40\u3002\u6808\u7684\u589e\u957f\u65b9\u5411\u4e3a\u4ece\u9ad8\u5730\u5740\u5230\u4f4e\u5730\u5740\u3002\u5728\u51fd\u6570\u5f00\u59cb\u5904\uff0c\u9996\u5148\u5206\u914d\u5c40\u90e8\u53d8\u91cf\u7684\u5185\u5b58\u7a7a\u95f4\uff0cr\u7136\u540e\u5c06 callee-saved \u5bc4\u5b58\u5668 push \u5230\u6808\u4e0a\uff0c\u6700\u540e\u5c06 lr \u548c fp \u5bc4\u5b58\u5668 push \u5230\u6808\u4e0a\uff08\u6ce8\u610f\u8fd9\u91cc\u548cx86/x64\u7684\u4e0d\u540c\uff09\u3002\u5728\u51fd\u6570\u8fd4\u56de\u524d\uff0c\u6062\u590d lr, fp \u548c callee-saved \u5bc4\u5b58\u5668\u7684\u503c\uff0c\u5e76\u56de\u6536\u6808\u7a7a\u95f4\u3002</p> <p>\u6839\u636e\u6808\u5e27\u7684\u5e03\u5c40\uff0c\u5f53\u653b\u51fb\u8005\u5229\u7528\u67d0\u4e2a\u5c40\u90e8\u53d8\u91cf\u7684\u7f13\u51b2\u533a\u6ea2\u51fa\u6f0f\u6d1e\u65f6\uff0c\u8986\u76d6\u7684\u662f\u4e0a\u4e00\u4e2a\u51fd\u6570\u6808\u5e27\u7684 x29 \u548c x30\u3002</p> <pre><code>                               \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                               \u2502                \u2502\n       High Addr \u2502             \u2502                \u2502\n                 \u2502             \u2502                \u2502\n                 \u2502             \u2502      ...       \u2502\n                 \u2502             \u2502                \u2502    caller function\n                 \u2502             \u2502      x30       \u2502\n                 \u2502             \u2502                \u2502\n                 \u2502             \u2502      x29       \u2502\n                 \u2502             \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n                 \u2502             \u2502    local var   \u2502\n                 \u2502             \u2502                \u2502\n                 \u2502             \u2502  callee-saved  \u2502\n                 \u2502             \u2502                \u2502    callee fucntion\n                 \u2502             \u2502       x30      \u2502\n       Low Addr  \u2502             \u2502                \u2502\n                 \u2502             \u2502       x29      \u2502\n                 \u25bc    \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                        sp/fp\n</code></pre> <p>\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0cARM64 \u4e2d\u548c x86-64 \u4e0d\u540c\uff0c\u6ca1\u6709\u63d0\u4f9b push \u548c pop \u6307\u4ee4\uff0c\u53ef\u4ee5\u901a\u8fc7 str \u6307\u4ee4\u548c ldr \u6307\u4ee4\u5b9e\u73b0 push \u548c pop\u3002</p> <pre><code>stp x29, x30, [sp, #-32]!\nmov x29, sp\nstr x19, [sp, #16]\n\n...\n\nldr x19, [sp, #16]\nldp x29, x30, [sp], #32\nret\n</code></pre> <p>\u8fd9\u6bb5\u4ee3\u7801\u5c55\u793a\u4e86\u67d0\u4e2a\u51fd\u6570\u5f00\u59cb\u5904\u548c\u8fd4\u56de\u524d\u7684\u4ee3\u7801\u3002\u5728\u51fd\u6570\u5f00\u59cb\u5904\uff0c\u5c06 sp \u51cf\u53bb32\uff0c\u4e5f\u5c31\u662f\u5728\u6808\u4e0a\u5206\u914d\u4e8632\u5b57\u8282\u7684\u7a7a\u95f4\uff0c\u5c06 x29 \u4fdd\u5b58\u5728[sp], \u5728 x30 \u4fdd\u5b58\u5728[sp + 8], \u5c06\u8be5\u51fd\u6570\u8981\u7528\u5230\u7684 callee-saved \u5bc4\u5b58\u5668 x19 \u4fdd\u5b58\u5728[sp + 16]\u3002</p> <p>\u5728\u51fd\u6570\u8fd4\u56de\u524d\uff0c\u5206\u522b\u4ece\u6808\u4e0a\u6062\u590d callee-saved \u5bc4\u5b58\u5668\u548c x29, x30 \u5bc4\u5b58\u5668\u7684\u503c\uff0c\u5e76\u5c06 sp \u52a0\u4e0a32\uff0c\u4e5f\u5c31\u662f\u56de\u653632\u5b57\u8282\u7684\u7a7a\u95f4\u3002</p>"},{"location":"lab1/#33","title":"3.3 \u76f8\u5173\u5b89\u5168\u673a\u5236","text":""},{"location":"lab1/#kaslr","title":"KASLR","text":"<p>KASLR(Kernel address space layout randomization) \u662f Linux \u5185\u6838\u7684\u4e00\u4e2a\u5b89\u5168\u673a\u5236\uff0c\u8be5\u673a\u5236\u53ef\u4ee5\u8ba9\u5185\u6838\u6bcf\u6b21\u542f\u52a8\u65f6\uff0c\u968f\u673a\u751f\u6210\u4e00\u4e2a\u504f\u79fb\u91cf\uff0c\u5185\u6838\u955c\u50cf\u7684\u94fe\u63a5\u5730\u5740\u52a0\u4e0a\u8fd9\u4e2a\u504f\u79fb\u624d\u662f\u5185\u6838\u955c\u50cf\u6700\u7ec8\u6620\u5c04\u7684\u865a\u62df\u5730\u5740\u3002\u8be5\u673a\u5236\u4f7f\u5185\u6838\u7b26\u53f7\u7684\u5730\u5740\u53d8\u5f97\u968f\u673a\uff0c\u589e\u5927\u4e86\u653b\u51fb\u8005\u83b7\u53d6\u5185\u6838\u7b26\u53f7\u5730\u5740\u7684\u96be\u5ea6\uff0c\u65e0\u6cd5\u8f7b\u6613\u53d1\u8d77 ROP \u7b49\u653b\u51fb\u3002</p> <p>\u7136\u800c\uff0c\u653b\u51fb\u8005\u4ecd\u7136\u53ef\u4ee5\u7ed5\u8fc7 KASLR\u3002\u653b\u51fb\u8005\u80fd\u591f\u5229\u7528\u5185\u6838\u4e2d\u7684\u4fe1\u606f\u6cc4\u9732\u6f0f\u6d1e\u83b7\u53d6\u67d0\u4e2a\u51fd\u6570\u6240\u5728\u7684\u865a\u62df\u5730\u5740\uff0c\u901a\u8fc7\u4e0e\u7f16\u8bd1\u5185\u6838\u65f6\u4ea7\u751f\u7684\u94fe\u63a5\u5730\u5740\u76f8\u51cf\uff0c\u5c31\u53ef\u4ee5\u83b7\u53d6\u672c\u6b21\u8fd0\u884c\u751f\u6210\u7684\u504f\u79fb\u503c\uff0c\u4ece\u800c\u83b7\u53d6\u4e86\u5185\u6838\u6240\u6709\u51fd\u6570\u7684\u865a\u62df\u5730\u5740\u3002</p>"},{"location":"lab1/#canary","title":"canary","text":"<p>stack canary \u662f\u4e00\u79cd\u7528\u4e8e\u9632\u8303\u6808\u7f13\u51b2\u533a\u6ea2\u51fa\u653b\u51fb\u7684\u5b89\u5168\u673a\u5236\u3002\u5f53\u4e00\u6bb5\u5185\u5b58\u88ab\u62f7\u8d1d\u5230\u6808\u4e0a\u7684\u5c40\u90e8\u53d8\u91cf\u65f6\uff0c\u5982\u679c\u62f7\u8d1d\u957f\u5ea6\u662f\u7531\u7528\u6237\u63a7\u5236\u7684\u4e14\u6ca1\u6709\u68c0\u67e5\u957f\u5ea6\u7684\u5408\u6cd5\u6027\u65f6\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u8986\u76d6\u6389\u4f4d\u4e8e\u7f13\u51b2\u533a\u4e0a\u65b9\u7684\u8fd4\u56de\u5730\u5740\uff0c\u4ece\u800c\u5b9e\u73b0\u63a7\u5236\u6d41\u52ab\u6301\u3002\u4e3a\u4e86\u9632\u8303\u8be5\u7c7b\u653b\u51fb\uff0cLinux \u5185\u6838\u5f15\u5165\u4e86 stack canary \u3002\u652f\u6301canary\u7684\u6808\u5e03\u5c40\u5982\u4e0b\u56fe\u6240\u793a\uff0ccanary\u4f4d\u4e8e\u5c40\u90e8\u53d8\u91cf\u4e0a\u65b9\u3002</p> <pre><code>                                   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                   \u2502                \u2502\n           High Addr \u2502             \u2502                \u2502\n                     \u2502             \u2502                \u2502\n                     \u2502             \u2502      ...       \u2502\n                     \u2502             \u2502                \u2502    caller function\n                     \u2502             \u2502      x30       \u2502\n                     \u2502             \u2502                \u2502\n                     \u2502             \u2502      x29       \u2502\n                     \u2502             \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n                     \u2502             \u2502     canary     \u2502\n                     \u2502             \u2502                \u2502\n                     \u2502             \u2502    local var   \u2502\n                     \u2502             \u2502                \u2502    callee fucntion\n                     \u2502             \u2502  callee-saved  \u2502\n           Low Addr  \u2502             \u2502                \u2502\n                     \u2502             \u2502       x30      \u2502\n                     \u25bc             \u2502                \u2502\n                          \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba \u2502       x29      \u2502\n                            sp/fp  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>stack canary \u5728\u51fd\u6570\u7684\u5f00\u59cb\u65f6push\u5230\u6808\u4e0a\uff0c\u5728\u51fd\u6570\u8fd4\u56de\u524d\uff0c\u68c0\u67e5\u662f\u5426\u88ab\u7be1\u6539\u3002\u5047\u5982\u653b\u51fb\u8005\u901a\u8fc7\u7f13\u51b2\u533a\u6ea2\u51fa\u6f0f\u6d1e\u8986\u76d6\u4e86\u6808\u4e0a\u7684\u8fd4\u56de\u5730\u5740\uff0c\u90a3\u4e48 stack canary \u80af\u5b9a\u4e5f\u88ab\u8986\u76d6\u3002\u51fd\u6570\u5728\u8fd4\u56de\u524d\u68c0\u67e5\u53d1\u73b0 stack canary \u7684\u503c\u88ab\u7be1\u6539\uff0c\u5219\u8bf4\u660e\u6808\u7684\u5185\u5bb9\u5df2\u88ab\u7834\u574f\uff0c\u5185\u6838\u76f4\u63a5 panic\u3002</p> <p>\u7136\u800c\uff0cstack canary \u5b89\u5168\u673a\u5236\u4e5f\u662f\u53ef\u4ee5\u88ab\u7ed5\u8fc7\u7684\u3002\u5728\u5185\u6838\u5b9e\u73b0\u4e2d\uff0cstack canary \u662f per-task \u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e00\u4e2a\u8fdb\u7a0b\u6240\u6709\u6808\u5e27\u7684 stack canary \u7684\u503c\u90fd\u662f\u76f8\u540c\u7684\uff0c\u5982\u679c\u653b\u51fb\u8005\u901a\u8fc7\u7f13\u51b2\u533a\u6ea2\u51fa\u8bfb\u6cc4\u9732\u4e86\u67d0\u4e2a\u6808\u5e27\u7684 canary \uff0c\u90a3\u4e48\u653b\u51fb\u8005\u5728\u53d1\u8d77\u9488\u5bf9\u8be5\u8fdb\u7a0b\u7684\u7f13\u51b2\u533a\u6ea2\u51fa\u653b\u51fb\u65f6\uff0c\u5c31\u53ef\u4ee5\u5c06 stack canary \u8986\u76d6\u4e3a\u5408\u6cd5\u503c\uff0c\u4ece\u800c\u7ed5\u8fc7 stack canary \u7684\u68c0\u67e5\u3002</p> <p>\u901a\u5e38\u83b7\u5f97canary\u7684\u624b\u6bb5\u6709</p> <ul> <li>\u901a\u8fc7\u8d8a\u754c\u8bfb</li> <li>\u901a\u8fc7overflow\uff0c\u8bfb\u53d6\u539f\u5b57\u7b26\u4e32\u80fd\u5e26\u51facanary</li> <li>\u4e0d\u80fd\u8bfb\u53d6\u7684\u65f6\u5019\uff0c\u4e14\u7b26\u5408Blind ROP\u7684\u6761\u4ef6\u65f6\uff0c\u901a\u8fc7overflow\u9ad8\u6548\u7206\u7834</li> </ul> <p></p>"},{"location":"lab1/#34-cred","title":"3.4 cred\u7ed3\u6784\u4f53","text":"<p>\u5728 Linux \u5185\u6838\u4e2d\uff0c\u7ed3\u6784\u4f53 cred \u8bb0\u5f55\u4e86\u8fdb\u7a0b\u7684\u6743\u9650\uff0c\u8be5\u7ed3\u6784\u4f53\u4fdd\u5b58\u4e86\u8be5\u8fdb\u7a0b\u7684 uid, gid \u7b49\u4fe1\u606f\uff08Linux \u7528 task_struct \u7ed3\u6784\u6765\u7ba1\u7406\u6bcf\u4e2a\u8fdb\u7a0b\uff0c\u8be5\u7ed3\u6784\u4f53\u4e2d\u6709\u4e2a\u6210\u5458\u6307\u5411 cred\uff09\u3002\u5982\u679c\u653b\u51fb\u8005\u80fd\u591f\u4fee\u6539\u8fdb\u7a0b\u7684 cred \u7ed3\u6784\u4f53\uff0c\u5c06 uid \u7b49\u5b57\u6bb5\u4fee\u6539\u4e3a0,\u8be5\u8fdb\u7a0b\u5c31\u62e5\u6709\u4e86 root \u6743\u9650\u3002</p> <p>Linux \u5185\u6838\u4e3b\u8981\u901a\u8fc7\u4ee5\u4e0b\u4e24\u4e2aAPI\u4fee\u6539\u8fdb\u7a0b\u6743\u9650\uff1a</p> <p>\u5176\u4e2d prepare_kernel_cred \u51fd\u6570\u7528\u4e8e\u6784\u9020\u65b0\u7684 cred \u7ed3\u6784\u4f53\uff0c\u5f53\u7ed9\u8be5\u51fd\u6570\u4f20\u9012\u7684\u53c2\u6570\u4e3a NULL \u65f6\uff0c\u8be5\u51fd\u6570\u4f1a\u6784\u9020\u4e00\u4e2a\u62e5\u6709 root \u6743\u9650\u7684 cred \u7ed3\u6784\u4f53\uff1b</p> <p>commit_cred \u51fd\u6570\u7528\u4e8e\u7ed9\u5f53\u524d\u8fdb\u7a0b\u8bbe\u7f6e\u65b0\u7684 cred \u7ed3\u6784\u4f53\u3002\u901a\u8fc7\u8c03\u7528 commit_creds(prepare_kernel_cred(0)) ,\u5c31\u80fd\u5c06\u5f53\u524d\u8fdb\u7a0b\u7684\u6743\u9650\u4fee\u6539\u4e3a root \u6743\u9650\u3002</p>"},{"location":"lab1/#4","title":"4.\u5b9e\u9a8c\u73af\u5883\u4e0e\u4ecb\u7ecd","text":""},{"location":"lab1/#41","title":"4.1 \u5b9e\u9a8c\u73af\u5883","text":"<p>\u672c\u6b21\u5b9e\u9a8c\u63d0\u4f9b\u4e86\u4e24\u79cd\u65b9\u5f0f\u8fdb\u884c\u73af\u5883\u914d\u7f6e\uff0c\u4efb\u9009\u4e00\u79cd</p> <p>1.VirtualBox \u865a\u62df\u673a\uff08\u26a0\ufe0f\u6ce8\u610farm mac\u65e0\u6cd5\u6b63\u5e38\u8fd0\u884c\u8fd9\u4e2a\u865a\u62df\u673a\uff0cwindows\u53ef\u4ee5\uff09\uff0c\u865a\u62df\u673a\u73af\u5883\u4e3a Ubuntu20.04\uff0c\u7528\u6237\u540d\u548c\u5bc6\u7801\u5747\u4e3a syssec\uff08ubuntu-lab1.zip\u548cubuntu-lab1.z01\u90fd\u8981\u4e0b\u8f7d\uff0c\u5168\u90e8\u5b8c\u6bd5\u4e4b\u540e\u5c06zip\u6587\u4ef6\u6b63\u5e38\u89e3\u538b\uff09\uff1b</p> <p>2.\u5982\u679c\u4f60\u5acc\u4e0b\u8f7d\u3001\u5b89\u88c5\u865a\u62df\u673a\u9ebb\u70e6\u6216\u662farm mac\uff0c\u53ef\u4ee5\u53ea\u4e0b\u8f7d\u4e0d\u5305\u542b\u865a\u62df\u673a\u7684\u6e90\u6587\u4ef6 <code>lab1-source.zip</code>\uff0c\u81ea\u884c\u8fdb\u884c\u73af\u5883\u914d\u7f6e\u3002</p> <ul> <li>\u70b9\u51fb\u767e\u5ea6\u7f51\u76d8\u94fe\u63a5,\u8bbf\u95ee\u7801\uff1abedq</li> </ul> <p>\u865a\u62df\u673a\u5185\u5305\u542b\u4e86\u5b8c\u6210\u672c\u6b21\u5b9e\u9a8c\u6240\u9700\u8981\u7684\u5404\u79cd\u73af\u5883\u3002\u672c\u6b21\u5b9e\u9a8c\u7684\u6587\u4ef6\u4fdd\u5b58\u5728\u865a\u62df\u673a <code>~/lab1</code>\u76ee\u5f55\u4e2d\u3002</p> <pre><code>syssec@VM:~/lab1$ tree -L 1\n.\n\u251c\u2500\u2500 Image\n\u251c\u2500\u2500 linux-5.15\n\u251c\u2500\u2500 rootfs.cpio.gz\n\u251c\u2500\u2500 share\n\u251c\u2500\u2500 start.sh\n\u2514\u2500\u2500 vmlinux\n\n2 directories, 4 files\n</code></pre> <p>\u5176\u4e2d\uff0c<code>Image</code> \u548c <code>vmlinux</code> \u662f\u6709\u6f0f\u6d1e\u7684\u5185\u6838\u955c\u50cf\uff0c<code>rootfs.cpio.gz</code> \u662f\u7b80\u6613\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c<code>linux-5.15</code> \u76ee\u5f55\u662f\u6574\u4e2a\u5185\u6838\u7684\u6e90\u4ee3\u7801\uff0c<code>start.sh</code> \u662f\u542f\u52a8\u5185\u6838\u7684\u811a\u672c\uff0c<code>share</code>\u76ee\u5f55\u662f qemu \u548c\u5bbf\u4e3b\u673a\u7684\u5171\u4eab\u76ee\u5f55\u3002\u4e3a\u4e86\u5feb\u901f\u542f\u52a8\u5185\u6838\uff0c\u65b9\u4fbf\u540c\u5b66\u4eec\u8c03\u8bd5\uff0c\u4f7f\u7528\u4e86\u7b80\u6613\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u7f3a\u4e4f\u5e38\u7528\u7684\u547d\u4ee4\u3002\u540c\u5b66\u4eec\u53ef\u4ee5\u5728\u5bbf\u4e3b\u673a\u5185\u7f16\u5199\u3001\u7f16\u8bd1 PoC \u7a0b\u5e8f\uff0c\u5e76\u62f7\u8d1d\u5230 <code>share</code> \u76ee\u5f55\u4e2d\uff0c\u5141\u8bb8\u5728 qemu \u4e2d\u8bbf\u95ee\u3002</p>"},{"location":"lab1/#42","title":"4.2 \u5b9e\u9a8c\u4ecb\u7ecd","text":"<p>\u672c\u5b9e\u9a8c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6709 buffer overflow \u6f0f\u6d1e\u7684 driver\uff0c\u53ef\u4ee5\u901a\u8fc7 /dev/zjubof \u8bbf\u95ee\u3002\u8be5\u9a71\u52a8\u63d0\u4f9b\u4e86 read, write \u4e24\u79cd\u63a5\u53e3\uff0c\u901a\u8fc7\u8fd9\u4e24\u4e2a\u63a5\u53e3\uff0c\u7528\u6237\u53ef\u4ee5\u89e6\u53d1 buffer overflow \u6f0f\u6d1e\u5e76\u901a\u8fc7 ROP \u653b\u51fb\u83b7\u53d6 Linux \u5185\u6838\u7684 root \u6743\u9650\u3002\u8be5 driver \u7684\u4f7f\u7528\u6848\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>int fd = open(\"/dev/zjubof\", O_RDWR);  //\u6253\u5f00\u8be5\u8bbe\u5907\uff0c\u8fd4\u56de\u6587\u4ef6\u63cf\u8ff0\u7b26fd\n\nif (fd &lt; 0)\n{\n    perror(\"open fail\\n\");\n    return -1;\n}\n\nint len = 0;\nchar buf[50] = \"hello\";\nlen = write(fd, buf, 5);    // \u5c06 buf \u7684\u5185\u5bb9\u5199\u5165\u8be5 driver\uff0c\u957f\u5ea6\u4e3a5\u5b57\u8282\nlen = read(fd, buf, 48);    // \u4ece driver \u4e2d\u8bfb\u53d648\u5b57\u8282\u7684\u5185\u5bb9\uff0c\u7ed3\u679c\u4fdd\u5b58\u5230 cmd\u3002\n\nclose(fd);                  //\u5173\u95ed\u8be5\u8bbe\u5907\n</code></pre> <p>\u6211\u4eec\u7f16\u5199\u7684\u9a71\u52a8\u4f4d\u4e8e <code>drivers/misc/bofdriver.c</code> \u4e2d\uff0c<code>zjubof_read</code> \u51fd\u6570\u5728\u7528\u6237\u8c03\u7528 <code>read</code> \u51fd\u6570\u65f6\u88ab\u8c03\u7528\uff0c<code>zjubof_write</code> \u51fd\u6570\u5728\u7528\u6237\u8c03\u7528 <code>write</code> \u51fd\u6570\u65f6\u88ab\u8c03\u7528\u3002</p> <p><code>zjubof_write</code> \u51fd\u6570\u6700\u7ec8\u8c03\u7528\u4e86 <code>zjubof_write4</code> \u51fd\u6570\uff0c\u8be5\u51fd\u6570\u7684\u53c2\u6570 <code>len</code> \u63a7\u5236\u4e86\u62f7\u8d1d\u7684\u957f\u5ea6\uff0c\u5b58\u5728 buffer overflow write \u6f0f\u6d1e\u3002</p> <p><code>zju_read</code> \u51fd\u6570\u8bfb\u53d6\u7684\u5185\u5bb9\u662f\u5168\u5c40\u53d8\u91cf <code>prev.cmd</code> \uff0c\u8be5\u503c\u7531 <code>zjubof_write4</code> \u586b\u5145\uff0c<code>zjubof_write4</code> \u51fd\u6570\u5b58\u5728 buffer overflow read \u6f0f\u6d1e\u3002\u8bf7\u540c\u5b66\u4eec\u601d\u8003\u5982\u4f55\u63a7\u5236 cmd.length \u7684\u503c\uff0c\u4ece\u800c\u6cc4\u9732 canary \u548c lr\u3002</p>"},{"location":"lab1/#43-gdb","title":"4.3 GDB \u8c03\u8bd5\u5185\u6838","text":""},{"location":"lab1/#431","title":"4.3.1 \u6b65\u9aa4","text":"<p>\u4fee\u6539 <code>start.sh</code> \u811a\u672c\uff0c\u52a0\u4e0a <code>-s</code> \u9009\u9879\u3002\u7531\u4e8e\u5185\u6838\u5f00\u542f\u4e86 KASLR \u673a\u5236\uff0cGDB\u65e0\u6cd5\u6253\u65ad\u70b9\uff0c\u56e0\u6b64\u5728\u7528 GDB \u8c03\u8bd5\u65f6\uff0c\u9700\u8981\u5173\u95ed KASLR\uff0c\u5177\u4f53\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>qemu-system-aarch64 -M virt \\\n    -cpu max \\\n    -smp 2 \\\n    -m 512 \\\n    -kernel ./Image \\\n    -nographic \\\n    -append \"console=ttyAMA0 root=/dev/ram rdinit=/sbin/init nokaslr\" \\ # \u5173\u95ed KASLR\n    -initrd ./rootfs.cpio.gz\\\n        -fsdev local,security_model=passthrough,id=fsdev0,path=./share\\\n    -device virtio-9p-pci,id=fs0,fsdev=fsdev0,mount_tag=hostshare \\\n    -s \\ # \u5141\u8bb8gdb\u901a\u8fc7\u7aef\u53e31234\u8fdb\u884c\u8c03\u8bd5\n</code></pre> <p><code>gdb-multiarch</code> \u547d\u4ee4\u6ca1\u6709\u5728\u865a\u62df\u673a\u73af\u5883\u4e2d\u5b89\u88c5\uff0c\u901a\u8fc7 <code>sudo apt install gdb-multiarch</code> \u547d\u4ee4\u5b89\u88c5\u3002</p> <p>\u4f7f\u7528\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>#\u7b2c\u4e00\u4e2a shell\n./start.sh\n\nsudo apt install gdb-multiarch\n\n#\u7b2c\u4e8c\u4e2ashell\ngdb-multiarch vmlinux\n(gdb) target remote :1234\n\n# \u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u6253\u65ad\u70b9\u8c03\u8bd5\u4e86\n</code></pre> <p>gef \u662f GDB \u7684\u4e00\u4e2a\u63d2\u4ef6\uff0c\u540c\u5b66\u4eec\u53ef\u4ee5\u53bb\u4e0b\u8f7d\u4f7f\u7528\u3002</p> <p>\u5982\u679c\u60f3\u8981\u5728 GDB \u8c03\u8bd5\u8fc7\u7a0b\u4e2d\u89c2\u5bdf\u6c47\u7f16\u4ee3\u7801\u5bf9\u5e94\u7684C\u6e90\u7801\uff0c\u53ef\u4ee5\u5c06 <code>vmlinux</code> \u79fb\u5230 Linux\u5185\u6838\u6e90\u7801\u76ee\u5f55 <code>linux-5.15</code> \u4e2d\u3002</p>"},{"location":"lab1/#432-gdb","title":"4.3.2 GDB \u5e38\u7528\u547d\u4ee4","text":"<ul> <li>(gdb) layout asm: \u663e\u793a\u6c47\u7f16\u4ee3\u7801</li> <li>(gdb) start: \u5355\u6b65\u6267\u884c\uff0c\u8fd0\u884c\u7a0b\u5e8f\uff0c\u505c\u5728\u7b2c\u4e00\u6267\u884c\u8bed\u53e5</li> <li>(gdb) continue: \u4ece\u65ad\u70b9\u540e\u7ee7\u7eed\u6267\u884c\uff0c\u7b80\u5199 c</li> <li>(gdb) next: \u5355\u6b65\u8c03\u8bd5\uff08\u9010\u8fc7\u7a0b\uff0c\u51fd\u6570\u76f4\u63a5\u6267\u884c\uff09\uff0c\u7b80\u5199 n</li> <li>(gdb) step instruction: \u6267\u884c\u5355\u6761\u6307\u4ee4\uff0c\u7b80\u5199 si</li> <li>(gdb) run: \u91cd\u65b0\u5f00\u59cb\u8fd0\u884c\u6587\u4ef6\uff08run-text\uff1a\u52a0\u8f7d\u6587\u672c\u6587\u4ef6\uff0crun-bin\uff1a\u52a0\u8f7d\u4e8c\u8fdb\u5236\u6587\u4ef6\uff09\uff0c\u7b80\u5199 r</li> <li>(gdb) backtrace\uff1a\u67e5\u770b\u51fd\u6570\u7684\u8c03\u7528\u7684\u6808\u5e27\u548c\u5c42\u7ea7\u5173\u7cfb\uff0c\u7b80\u5199 bt</li> <li>(gdb) break \u8bbe\u7f6e\u65ad\u70b9\uff0c\u7b80\u5199 b</li> <li>\u65ad\u5728 foo \u51fd\u6570\uff1ab foo</li> <li>\u65ad\u5728\u67d0\u5730\u5740: b * 0x80200000</li> <li>(gdb) finish: \u7ed3\u675f\u5f53\u524d\u51fd\u6570\uff0c\u8fd4\u56de\u5230\u51fd\u6570\u8c03\u7528\u70b9</li> <li>(gdb) frame: \u5207\u6362\u51fd\u6570\u7684\u6808\u5e27\uff0c\u7b80\u5199 f</li> <li>(gdb) print: \u6253\u5370\u503c\u53ca\u5730\u5740\uff0c\u7b80\u5199 p</li> <li>(gdb) info\uff1a\u67e5\u770b\u51fd\u6570\u5185\u90e8\u5c40\u90e8\u53d8\u91cf\u7684\u6570\u503c\uff0c\u7b80\u5199 i</li> <li>\u67e5\u770b\u5bc4\u5b58\u5668 ra \u7684\u503c\uff1ai r ra</li> <li>(gdb) display\uff1a\u8ffd\u8e2a\u67e5\u770b\u5177\u4f53\u53d8\u91cf\u503c</li> <li>(gdb) x/4x : \u4ee5 16 \u8fdb\u5236\u6253\u5370 \u5904\u5f00\u59cb\u7684 16 Bytes \u5185\u5bb9</li> </ul> <p>\u66f4\u591a\u547d\u4ee4\u53ef\u4ee5\u53c2\u8003100\u4e2agdb\u6280\u5de7</p> <p>\u8bf7\u6ce8\u610f\u6700\u540e\u4e00\u5b9a\u8981\u5728\u5f00\u542f KASLR \u7684\u60c5\u51b5\u4e0b\u83b7\u53d6\u5185\u6838\u6743\u9650\u3002</p>"},{"location":"lab1/#5","title":"5.\u5b9e\u9a8c\u4efb\u52a1","text":"<p>\u672c\u6b21\u5b9e\u9a8c\u5206\u4e3a 4 \u4e2a Task\uff0c\u524d\u4e09\u4e2a Task \u8981\u6c42\u7f16\u5199 Poc \u4ee3\u7801\u5b9e\u73b0\u5bf9\u5e94\u76ee\u6807\uff0c Task4 \u8981\u6c42\u4e86\u89e3 Linux \u5185\u6838\u5bf9 ROP \u653b\u51fb\u7684\u9632\u62a4\u3002</p> <p>Poc \u4ee3\u7801\u7f16\u8bd1\u65b9\u6cd5\uff1a</p> <pre><code>aarch64-linux-gnu-gcc -static exp.c -o exp\n</code></pre>"},{"location":"lab1/#51-task1-stack-canary-kaslr","title":"5.1 Task1: \u7ed5\u8fc7 stack canary \u548c KASLR","text":"<p>Task1 \u8981\u6c42\u5229\u7528 buffer overflow read \u6cc4\u9732 stack canary \u7684\u503c\uff1b\u5e76\u83b7\u53d6\u5f53\u524d\u6808\u5e27\u4e0a\u4fdd\u5b58\u7684 lr \u503c\uff0c\u901a\u8fc7 <code>aarch64-linux-gnu-objdump</code> \u547d\u4ee4\u83b7\u53d6\u8be5\u8fd4\u56de\u5730\u5740\u5bf9\u5e94\u7684\u94fe\u63a5\u5730\u5740\uff0c\u4e24\u8005\u76f8\u51cf\uff0c\u5c31\u53ef\u4ee5\u83b7\u53d6\u5185\u6838\u955c\u50cf\u7684\u504f\u79fb\uff0c\u4ece\u800c\u7ed5\u8fc7 KASLR\u3002</p> <p><code>aarch64-linux-gnu-objdump</code> \u4f7f\u7528\u65b9\u6cd5\uff1a</p> <pre><code>aarch64-linux-gnu-objdump -d vmlinux &gt; dump.txt       #\u53cd\u6c47\u7f16\u6240\u6709\u51fd\u6570\uff0c\u7ed3\u679c\u4fdd\u5b58\u5728dump.txt\u4e2d\naarch64-linux-gnu-objdump --disassemble=zjubof_write vmlinux  #\u53cd\u6c47\u7f16zjubof_write\u51fd\u6570\n</code></pre> <p>\u8bf7\u6ce8\u610f\u5185\u6838\u6bcf\u6b21\u542f\u52a8\u7684 KASLR \u504f\u79fb\u503c\u90fd\u4e0d\u540c\uff0cTask 2\uff0c3\u7684\u5229\u7528\u4ee3\u7801\u8981\u5305\u542bTask 1 \u7684\u5229\u7528\u4ee3\u7801\u3002</p> <p>\u63d0\u793a\uff1a1. \u5728\u7f16\u5199PoC\u7684\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u4f1a\u9047\u5230\u52a0\u5165<code>system(\"/bin/sh\")</code>\u5bfc\u81f4\u5176\u4f59printf\u65e0\u6cd5\u8f93\u51fa\u7684\u95ee\u9898\uff0c\u6240\u4ee5\u53ef\u4ee5\u5148\u6ce8\u91ca\u6389<code>system(\"/bin/sh\")</code>\uff1b2. \u865a\u62df\u673a\u4e2d\u51fa\u73b0\u7684<code>can't access tty...</code>\uff0c\u4e0d\u4f1a\u5e72\u6270\u5229\u7528\u3002</p>"},{"location":"lab1/#52-task2-return-address-root","title":"5.2 Task2: \u4fee\u6539return address\uff0c\u83b7\u53d6 root \u6743\u9650","text":"<p>\u5728\u6cc4\u9732\u4e86 stack canary \u548c offset \u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5229\u7528 buffer overflow write \u6f0f\u6d1e\u8986\u76d6\u6389\u6808\u4e0a\u7684 lr \u503c\u3002\u5728Task2 \u4e2d\uff0c\u53ea\u9700\u8981\u8986\u76d6 lr \u4f7f\u6267\u884c\u6d41\u8df3\u8f6c\u5230 <code>first_level_gadget</code> \uff08\u8bf7\u6ce8\u610f\u8df3\u8f6c\u5230\u8be5\u51fd\u6570\u7684\u54ea\u4e00\u884c\uff09\uff0c\u8be5 gadget \u8c03\u7528 <code>commit_creds(prepare_kernel_cred(0))</code> \u63d0\u6743\uff0c\u5e76\u5c06\u6808\u6307\u9488\u8c03\u6574\u5230 <code>zjubof_write</code> \u51fd\u6570\u6808\u5e27\u7684\u5e95\u90e8\uff0c\u4e0e\u6b63\u5e38\u6267\u884c\u65f6\u7684sp\u4fdd\u6301\u4e00\u81f4\uff0c\u4ee5\u4fdd\u8bc1\u80fd\u6b63\u786e\u4ece <code>zjubof_write</code> \u51fd\u6570\u8fd4\u56de\u3002\u8bf7\u540c\u5b66\u4eec\u901a\u8fc7\u753b\u6808\u7684\u53d8\u5316\u56fe\u4ee5\u53ca\u901a\u8fc7 gdb \u8ffd\u8e2a\u6808\u7684\u53d8\u5316\uff0c\u641e\u6e05\u695a\u4e3a\u4ec0\u4e48\u8981\u8c03\u6574\u6808\u6307\u9488\u3002</p> <p>\u5728\u83b7\u53d6 root \u6743\u9650\u540e\uff0c\u8bfb\u53d6 <code>/root/flag.txt</code> \u6587\u4ef6\u83b7\u53d6 flag\u3002</p> <p>PoC \u4ee3\u7801\u793a\u4f8b\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;sys/stat.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;fcntl.h&gt;\n\nint main(int argc, char *argv[])\n{   \n    int fd = open(\"/dev/zjubof\", O_RDWR);\n\n    /*\n      Your Code\n    */\n\n    system(\"/bin/sh\");  //\u521b\u5efa\u65b0shell\n    return 0;\n}\n</code></pre> <p>PoC \u8fd0\u884c\u793a\u4f8b\uff1a</p> <pre><code>/mnt/share $ ./exp                    // \u8fd0\u884c\u5229\u7528\u4ee3\u7801\n/mnt/share #                          // \u6210\u529f\u83b7\u53d6root\u6743\u9650\uff0c\u6ce8\u610f'$'\u53d8\u4e3a '#'\n/mnt/share # cat /root/flag.txt       // \u8bfb\u53d6flag\n</code></pre> <p>\u601d\u8003\u9898\uff1a\u4e3a\u4ec0\u4e48\u5728exp\u4e2d\u76f4\u63a5\u8986\u76d6\u8fd4\u56de\u5730\u5740\u4e3a <code>first_level_gadget</code> \u7684\u7b2c\u4e00\u884c\uff0c\u4f1a\u9020\u6210kernel\u5728\u8fd0\u884c\u5230\u8fd9\u4e00\u884c\u7684\u65f6\u5019\u4ea7\u751fpanic\uff1f</p>"},{"location":"lab1/#53-task3-rop-root","title":"5.3 Task3: ROP \u83b7\u53d6 root \u6743\u9650","text":"<p>\u5728Task3\u4e2d\uff0c\u4e0d\u5141\u8bb8\u8df3\u8f6c\u5230 <code>first_level_gadget</code> \uff0c\u9700\u8981\u901a\u8fc7\u591a\u4e2aROP\u7247\u6bb5\u5b9e\u73b0\u63d0\u6743\u3002</p> <p>\u6b65\u9aa4:</p> <ul> <li>\u8df3\u8f6c\u5230 <code>prepare_kernel_cred</code> \u51fd\u6570\u4e2d\u5408\u9002\u7684\u4f4d\u7f6e \uff08\u8bf7\u6ce8\u610f\u4e0d\u80fd\u8df3\u8f6c\u5230\u51fd\u6570\u7684\u7b2c\u4e00\u884c\u6c47\u7f16\uff0c\u4e3a\u4ec0\u4e48\uff1f\uff09</li> <li>\u8df3\u8f6c\u5230 <code>commit_creds</code> \u51fd\u6570\u4e2d\u5408\u9002\u7684\u4f4d\u7f6e\uff08\u6ce8\u610f\u540c\u4e0a\uff09</li> <li>\u8df3\u8f6c\u5230 <code>second_level_gadget</code> \u51fd\u6570\u4e2d\u5408\u9002\u7684\u4f4d\u7f6e\uff0c\u5c06\u6808\u6307\u9488\u8c03\u6574\u5230\u5408\u9002\u7684\u4f4d\u7f6e\uff0c\u4ee5\u4fdd\u8bc1\u80fd\u6b63\u786e\u4ece <code>zjubof_write</code> \u51fd\u6570\u8fd4\u56de</li> <li>\u8df3\u8f6c\u56de <code>zjubof_write</code>\u51fd\u6570\u4e2d\u5408\u9002\u7684\u4f4d\u7f6e</li> </ul> <p>\u8bf7\u6ce8\u610f\u5728\u6784\u9020 ROP \u7684\u8fc7\u7a0b\u4e2d\uff0c\u6ce8\u610f sp \u7684\u53d8\u5316\uff0c\u5c06\u8df3\u8f6c\u5730\u5740\u5199\u5230\u6b63\u786e\u7684\u4f4d\u7f6e</p>"},{"location":"lab1/#54-task4-linux-rop","title":"5.4 Task4: Linux\u5185\u6838\u5bf9 ROP \u653b\u51fb\u7684\u9632\u62a4","text":"<p>ROP \u653b\u51fb\u7684\u53d1\u8d77\u9700\u8981\u4fee\u6539\u6808\u4e0a\u7684\u8fd4\u56de\u5730\u5740\u3002\u5728 ARM64 \u67b6\u6784\u7684 Linux \u5185\u6838\u4e2d\uff0cARM PA \u673a\u5236\u53ef\u7528\u4e8e\u4fdd\u62a4\u6808\u4e0a\u8fd4\u56de\u5730\u5740\u7684\u5b8c\u6574\u6027\u3002\u901a\u8fc7 <code>ARCH=arm64 make CROSS_COMPILE=aarch64-linux-gnu-  menuconfig</code> \u547d\u4ee4\u4fee\u6539\u5185\u6838\u7684\u914d\u7f6e\uff0c\u4f7f\u80fd Kernel Features -&gt; ARMV8.3 architecture features -&gt; Enable support for pointer authentication \u5c31\u5f00\u542f\u4e86 Linux \u5185\u6838\u5bf9 PA \u7684\u652f\u6301\u3002</p> <p>\u8bf7\u540c\u5b66\u4eec\u5f00\u542f PA \u652f\u6301\u540e\uff0c\u91cd\u65b0\u7f16\u8bd1\u5185\u6838\uff0c\u89c2\u5bdf <code>zjubof_write3</code> \u51fd\u6570\u7684\u6c47\u7f16\u6709\u4ec0\u4e48\u53d8\u5316\uff0c\u5206\u6790PA \u673a\u5236\u662f\u5982\u4f55\u4fdd\u8bc1\u653b\u51fb\u8005\u65e0\u6cd5\u53d1\u8d77 ROP \u653b\u51fb\u7684\u3002</p> <p>\u5185\u6838\u7f16\u8bd1\u65b9\u6cd5\uff1a</p> <pre><code>export ARCH=arm64\nmake CROSS_COMPILE=aarch64-linux-gnu- defconfig\nmake CROSS_COMPILE=aarch64-linux-gnu- menuconfig  # \u542f\u7528 PA \u652f\u6301\uff08\u9ed8\u8ba4\u5df2\u5f00\u542f\uff09\nmake CROSS_COMPILE=aarch64-linux-gnu- -j$(nproc)\n</code></pre>"},{"location":"lab1/#6","title":"6. \u5b9e\u9a8c\u63d0\u4ea4","text":"<p>\u8bf7\u540c\u5b66\u4eec\u5728\u5b66\u5728\u6d59\u5927\u4e0a\u63d0\u4ea4\u5b9e\u9a8c\u62a5\u544a\u3002\u683c\u5f0f\u8981\u6c42\u4e3apdf\uff0c\u547d\u540d\u4e3a\u5b66\u53f7+\u59d3\u540d+lab1.pdf\u3002\u5b9e\u9a8c\u62a5\u544a\u9700\u8981\u5305\u542b\u4ee5\u4e0b\u5185\u5bb9\uff1a</p> <ul> <li>\u5355\u8df3ROP\u548c\u591a\u8df3ROP\u7684PoC\u4ee3\u7801</li> <li>flag\u6587\u4ef6\u7684\u5185\u5bb9</li> <li>\u56de\u7b54\u601d\u8003\u9898</li> <li>\u4e3a\u4ec0\u4e48linux canary\u7684\u6700\u4f4e\u4f4dbyte\u603b\u662f <code>\\00</code>\uff1f</li> <li>\u5728ARM64\u7684ROP\u4e2d\uff0c\u5728 <code>zjubof_write4</code>\u4e2doverflow\u8986\u76d6\u5230\u7684\u8fd4\u56de\u5730\u5740\uff0c\u4f1a\u5728 \u4ec0\u4e48\u65f6\u5019/\u6267\u884c\u5230\u54ea\u4e2a\u51fd\u6570\u54ea\u4e00\u884c\u7684\u65f6\u5019 \u88abload\u5230pc\u5bc4\u5b58\u5668\uff1f</li> <li>\u5728Task2\u4e2d\uff0c\u4e3a\u4ec0\u4e48\u5728exp\u4e2d\u76f4\u63a5\u8986\u76d6\u8fd4\u56de\u5730\u5740\u4e3a <code>first_level_gadget</code> \u7684\u6c47\u7f16\u7b2c\u4e00\u884c\u5730\u5740\uff0c\u4f1a\u9020\u6210kernel\u5728\u8fd0\u884c\u5230\u8fd9\u4e00\u884c\u7684\u65f6\u5019\u4ea7\u751fpanic\uff1f\u5e76\u5199\u51fa\u9020\u6210\u8fd9\u4e2apanic\u7684\u89e6\u53d1\u94fe\u3002</li> <li>Linux \u5185\u6838\u662f\u5982\u4f55\u5229\u7528 ARM PA \u6765\u9632\u5fa1 ROP \u653b\u51fb\u7684</li> </ul>"},{"location":"lab2/","title":"Linux\u5185\u6838\u6f0f\u6d1e\u653b\u9632 - JOP\u653b\u51fb\u4e0e\u9632\u62a4","text":""},{"location":"lab2/#1","title":"1 \u5b9e\u9a8c\u76ee\u7684","text":"<p>\u4e86\u89e3 UAF ( Use-After-Free ) \u7c7b\u578b\u7684\u6f0f\u6d1e\u4ee5\u53ca JOP ( Jump-oriented programming ) \u653b\u51fb\u539f\u7406\uff0c\u5e76\u5728\u6b64\u57fa\u7840\u4e0a\uff0c\u901a\u8fc7\u73b0\u6709\u7684 UAF \u6f0f\u6d1e\u548c JOP \u7f16\u7a0b\uff0c\u5b9e\u73b0\u83b7\u53d6 Linux \u5185\u6838\u7684 root \u6743\u9650\u7684 PoC (Proof of Concept)\uff0c\u5e76\u8bfb\u53d6\u4e00\u4e2a\u53ea\u6709 root \u6743\u9650\u4e0b\u53ef\u8bfb\u7684\u6587\u4ef6\uff0c\u83b7\u53d6 flag\u3002</p>"},{"location":"lab2/#2","title":"2 \u5b9e\u9a8c\u5185\u5bb9","text":"<p>1\uff09 \u5229\u7528 gdb \u8c03\u8bd5\u5185\u6838\uff0c\u83b7\u53d6\u5185\u6838\u5173\u952e\u51fd\u6570\u548c gadget \u7684\u5730\u5740\u3002</p> <p>2\uff09 \u4e86\u89e3 Linux \u8bbe\u5907\u63d0\u4f9b\u7684\u63a5\u53e3\u548c\u5176\u8c03\u7528\u903b\u8f91\uff0c\u5e76\u5c1d\u8bd5\u4f7f\u7528 Linux \u8bbe\u5907\u63a5\u53e3\u8fdb\u884c\u57fa\u7840\u7f16\u7a0b\uff0c\u4e86\u89e3 Linux \u5982\u4f55\u5229\u7528\u7cfb\u7edf\u8c03\u7528\u7684\u65b9\u5f0f\u89e6\u53d1\u5185\u6838\u8bbe\u5907\u4e2d\u76f8\u5e94\u7684\u51fd\u6570\u3002</p> <p>3\uff09 \u7406\u89e3 UAF \u6f0f\u6d1e\u539f\u7406\uff0c\u4ee5\u53ca\u6f0f\u6d1e\u7684\u5229\u7528\u65b9\u5f0f\uff1b\u4f7f\u7528 gdb-multiarch \u5bf9\u6240\u63d0\u4f9b\u7684\u672a\u538b\u7f29\u7684\u5185\u6838( vmlinux \u6587\u4ef6)\u8fdb\u884c\u8c03\u8bd5\uff0c\u67e5\u627e\u8bbe\u5907 UAF \u6f0f\u6d1e\u6240\u5728\u7684\u4f4d\u7f6e\u53ca\u89e6\u53d1\u6761\u4ef6\uff0c\u83b7\u53d6\u5185\u6838 <code>tty_struct</code> \u7ed3\u6784\u4f53\u7684\u5185\u5bb9\uff0c\u5e76\u5229\u7528\u8bbe\u5907\u63a5\u53e3\u63a7\u5236\u8be5\u7ed3\u6784\u4f53\u7684\u5185\u5bb9\uff0c\u4e3a root \u5185\u6838\u505a\u51c6\u5907\u3002</p> <p>4\uff09 \u4e86\u89e3 JOP \u653b\u51fb\u7684\u539f\u7406\uff0c\u5c1d\u8bd5\u5229\u7528\u8bbe\u5907\u63a5\u53e3\u89e6\u53d1 UAF \u6f0f\u6d1e\uff0c\u5e76\u631f\u6301\u63a7\u5236\u6d41\uff0c\u901a\u8fc7 JOP \u653b\u51fb\u7ed5\u8fc7 PXN \u673a\u5236\uff0c\u83b7\u53d6\u5185\u6838\u7684 root \u6743\u9650\u3002</p> <p>5\uff09 \u5229\u7528\u63d0\u4f9b\u7684 gadget \u7247\u6bb5\uff0c\u6784\u9020 JOP \u653b\u51fb\u8df3\u8f6c\u94fe\uff0c\u83b7\u53d6 root \u6743\u9650\u7684 shell\u3002</p>"},{"location":"lab2/#3","title":"3 \u5b9e\u9a8c\u73af\u5883","text":"<ul> <li>\u5b9e\u9a8c\u6240\u9700\u5de5\u5177\uff1a</li> <li>Linux kernel 5.15</li> <li>QEMU \u6a21\u62df\u5668 \uff08qemu-system-aarch64\uff09</li> <li>gdb-multiarch \u591a\u67b6\u6784\u8c03\u8bd5\u5de5\u5177\u8c03\u8bd5 kernel</li> <li>gdb \u8c03\u8bd5\u5de5\u5177\u8c03\u8bd5\u7528\u6237\u6001\u7a0b\u5e8f</li> <li>\u5b9e\u9a8c\u63d0\u4f9b\u5185\u5bb9\uff1a</li> <li>QEMUrootfs \u6587\u4ef6\uff08\u5176\u5185\u90e8\u5305\u542b\u4e86 gdb\uff0cvim \u7b49\u5de5\u5177\uff09</li> <li>QEMU \u8fd0\u884c\u811a\u672c\uff08 qemu.sh \uff09</li> <li>vmlinux \u5185\u6838\u955c\u50cf(\u7528\u4e8e gdb-multiarch \u8c03\u8bd5)</li> </ul>"},{"location":"lab2/#4","title":"4 \u524d\u7f6e\u77e5\u8bc6","text":""},{"location":"lab2/#41-uaf","title":"4.1 UAF\u6f0f\u6d1e\u539f\u7406\u4e0e\u5229\u7528","text":"<p>Use-After-Free\uff0c\u5373\u5f53\u4e00\u5757\u5185\u5b58\u88ab\u91ca\u653e\u4e4b\u540e\u88ab\u518d\u6b21\u4f7f\u7528\uff0c\u4f46\u662f\u8fd9\u79cd\u4f7f\u7528\u4f1a\u5206\u4e3a\u51e0\u79cd\u60c5\u51b5\uff1a</p> <ul> <li>\u5185\u5b58\u5757\u88ab\u91ca\u653e\u4e4b\u540e\uff0c\u5bf9\u5e94\u7684\u6307\u9488\u88ab\u8bbe\u7f6e\u6210 NULL\uff0c\u7136\u540e\u7a0b\u5e8f\u4f7f\u7528\u7a7a\u6307\u9488\u5bfc\u81f4\u7684\u7a0b\u5e8f\u5d29\u6e83(\u4e00\u822c\u4f1a\u62a5\u6307\u9488\u89e3\u5f15\u7528\u9519\u8bef)\u3002</li> <li>\u5185\u5b58\u5757\u88ab\u91ca\u653e\u4e4b\u540e\uff0c\u5bf9\u5e94\u6307\u9488\u6ca1\u6709\u88ab\u8bbe\u7f6e\u6210 NULL\uff0c\u7136\u540e\u5728\u4f7f\u7528\u4e86\u8fd9\u4e2a\u6307\u9488\u4e4b\u524d\uff0c\u6ca1\u6709\u5bf9\u8fd9\u5757\u5185\u5b58\u8fdb\u884c\u4fee\u6539\uff0c\u7a0b\u5e8f\u5f88\u53ef\u80fd\u80fd\u591f\u6b63\u5e38\u8fd0\u8f6c\u3002</li> <li>\u5185\u5b58\u5757\u88ab\u91ca\u653e\u4e4b\u540e\uff0c\u5bf9\u5e94\u6307\u9488\u6ca1\u6709\u88ab\u8bbe\u7f6e\u6210 NULL\uff0c\u4e14\u5728\u4f7f\u7528\u8be5\u6307\u9488\u4e4b\u524d\u6709\u4ee3\u7801\u5bf9\u8fd9\u5757\u5185\u5b58\u8fdb\u884c\u4e86\u4fee\u6539\uff0c\u90a3\u4e48\u7a0b\u5e8f\u518d\u6b21\u4f7f\u7528\u8fd9\u5757\u5185\u5b58\uff0c\u4f1a\u5bfc\u81f4\u4e00\u4e9b\u5947\u602a\u7684\u95ee\u9898\uff0c\u6bd4\u5982\u8bbf\u95ee\u4e86\u53ef\u80fd\u4e0d\u5c5e\u4e8e\u8be5\u8fdb\u7a0b\u7684\u5185\u5b58\u5757(\u7531\u4e8e\u91ca\u653e\u540e\u4f1a\u88ab\u5185\u6838\u5206\u914d\u7ed9\u522b\u7684\u8fdb\u7a0b)\uff0c\u751a\u81f3\u901a\u8fc7\u8be5\u6307\u9488\u5bf9\u8fd9\u5757\u5185\u5b58\u8fdb\u884c\u4fee\u6539\uff0c\u7136\u540e\u5bfc\u81f4\u63a7\u5236\u6d41\u7684\u8df3\u8f6c\u7b49\u3002</li> </ul> <p>\u6211\u4eec\u4e00\u822c\u6240\u8bf4\u7684UAF\u6f0f\u6d1e\u6307\u7684\u90fd\u662f\u540e\u9762\u4e24\u79cd\uff0c\u91ca\u653e\u540e\u6ca1\u6709\u88ab\u8bbe\u7f6e\u4e3a NULL \u7684\u5185\u5b58\u6307\u9488\u88ab\u79f0\u4e3a\u60ac\u6302\u6307\u9488 ( dangling pointer)\u3002</p> <p>\u4e3a\u4e86\u66f4\u597d\u7684\u7406\u89e3 UAF\uff0c\u53ef\u4ee5\u5148\u770b\u4e00\u6bb5\u7b80\u5355\u7684 demo\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\ntypedef struct name \n{\n    char *myname;\n    int a, b, c;\n    void (*func)(char *str);\n    int a1, b1, c1;\n} NAME;\nvoid myprint(char *str) { printf(\"%s\\n\", str); }\nvoid printmyname(char *str) { printf(\"call print my name, %s\\n\", str); }\nint main() \n{\n    NAME *a;\n    a = (NAME *)malloc(sizeof(struct name));\n    a-&gt;func = myprint;\n    a-&gt;myname = \"I can also use it\";\n    a-&gt;func(\"this is my function\");\n    // free without modify\n    free(a);\n    a-&gt;func(\"I can also use it\"); \n    // free with modify\n    a-&gt;func = printmyname;\n    a-&gt;func(\"this is my function\");\n    // set NULL\n    a = NULL;\n    // printf(\"this pogram will crash...\\n\");\n    a-&gt;func(\"can not be printed...\");\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u8be5\u6bb5\u4ee3\u7801\u5c06\u4e00\u4e2a free \u8fc7\u540e\u7684\u6307\u9488\u7ee7\u7eed\u4f7f\u7528\uff0c\u8fd9\u4e5f\u662f\u524d\u8ff0\u6240\u8bb2\u7684 UAF \u7684\u57fa\u672c\u539f\u7406\u3002</p> <p>\u518d\u6765\u770b\u4e00\u6bb5\u7b80\u5355\u7684 hello world \u7a0b\u5e8f\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\nint main()\n{\n    char *p0;\n    p0 = (char *)malloc(sizeof(char)*10);   //\u6307\u9488p0\u7533\u8bf7\u5185\u5b58\uff1b\n    memcpy(p0,\"hello\",10);\n    printf(\"p0 Addr: %p, %s\\n\", p0, p0);      //\u6253\u5370\u5176\u5730\u5740\u4e0e\u503c\uff1b\n    free(p0);                               //\u91ca\u653ep0\uff1b\n\n    char *p1;\n    p1=(char *)malloc(sizeof(char)*10);\n    memcpy(p1,\"world\",10);\n    printf(\"p1 Addr: %p, %s\\n\", p1, p0);\n    return 0;\n}\n</code></pre> <p>\u8be5\u6bb5\u7a0b\u5e8f\u5148\u901a\u8fc7 malloc \u5206\u914d\u4e8616\u5b57\u8282\u5927\u5c0f\u7684\u5806\u4e0a\u5185\u5b58\u5757\uff0c\u968f\u540e\u8bb2\u8be5\u5185\u5b58\u5757 free\uff0c\u4e4b\u540e\u53c8\u5229\u7528 malloc \u5206\u914d\u4e86\u4e00\u5757\u540c\u6837\u5927\u5c0f\u7684\u5185\u5b58\u5757\u3002\u7136\u540e\u6211\u4eec\u770b\u4e00\u4e0b\u7a0b\u5e8f\u8fd0\u884c\u7ed3\u679c\uff1a</p> <pre><code>user@user-Super-Server:~/Desktop/play$ gcc test.c \nuser@user-Super-Server:~/Desktop/play$ ./a.out \np0 Addr:0x5605b5dde2a0,hello\np1 Addr:0x5605b5dde2a0,world\n</code></pre> <p>\u53ef\u4ee5\u53d1\u73b0\u5728\u5806\u4e0a\u5206\u914d\u540c\u6837\u5927\u5c0f\u7684\u5185\u5b58\u65f6\u5019\uff0c\u7b2c\u4e8c\u6b21\u5206\u914d\u7684\u5730\u5740\u4e0e\u7b2c\u4e00\u6b21\u5206\u914d\u7684\u5730\u5740\u662f\u4e00\u6837\u7684\uff0c\u90fd\u662f <code>0x5605b5dde2a0</code>\u3002</p> <p>Question 1\uff1a\u4e3a\u4ec0\u4e48\u4f1a\u8fd9\u6837\uff1f\u4e3a\u4ec0\u4e48\u4e24\u6b21\u5206\u914d\u7684\u5185\u5b58\u5757\u5730\u5740\u4f1a\u4e00\u6837\uff1f</p> <p>\u63d0\u793a\uff1a\u5806\u4e0a\u5185\u5b58\u5206\u914d\u7b97\u6cd5\uff0c\u6ce8\u610fglibc 2.26\u524d\u540e\u7684\u4e0d\u540c\uff0c\u6ce8\u610f\u7528\u6237\u6001\u4e0e\u5185\u6838\u6001\u7684\u4e0d\u540c</p> <p>\u7531\u6b64\u6211\u4eec\u4fbf\u53ef\u4ee5\u77e5\u9053 UAF \u7684\u5229\u7528\u8fc7\u7a0b\uff1a</p> <ul> <li>\u5185\u5b58\u4e2d\u5b58\u5728\u4e00\u4e2a\u7a7a\u60ac\u6307\u9488\u6307\u5411\u4e00\u5757\u653b\u51fb\u8005\u53ef\u63a7\u7684\u5185\u5b58\u3002\u968f\u540e\u5c06\u8be5\u5185\u5b58\u91ca\u653e\uff0c\u4f46\u662f\u4e0d\u5c06\u6307\u9488\u7f6e\u7a7a\uff0c\u6545\u653b\u51fb\u8005\u4ecd\u7136\u53ef\u4ee5\u5229\u7528\u6307\u9488\u63a7\u5236\u8fd9\u5757\u5185\u5b58\u7684\u5185\u5bb9\u3002</li> <li>\u522b\u7684\u8fdb\u7a0b\u6216\u5185\u6838\u901a\u8fc7 malloc/kmalloc \u7533\u8bf7\u4e86\u4e00\u5757\u540c\u6837\u5927\u5c0f\u7684\u5185\u5b58\u5757\uff0c\u4f1a\u5c06\u653b\u51fb\u8005\u53ef\u63a7\u7684\u8fd9\u5757\u5185\u5b58\u5206\u914d\u51fa\u53bb\u3002</li> <li>\u7531\u4e8e\u8fd9\u5757\u5185\u5b58\u5185\u5bb9\u653b\u51fb\u8005\u53ef\u63a7\uff0c\u5c31\u53ef\u4ee5\u5229\u7528\u8be5\u5757\u5185\u5b58\u5b9e\u65bd\u653b\u51fb\u624b\u6bb5\uff0c\u5305\u62ec\u52ab\u6301\u63a7\u5236\u6d41\uff0c\u6cc4\u9732\u6570\u636e\u7b49\uff0c\u6700\u7ec8\u8fbe\u5230\u83b7\u53d6 root \u6743\u9650\u7684\u76ee\u7684\u3002</li> </ul>"},{"location":"lab2/#42-linux-slab","title":"4.2 Linux slab \u5185\u5b58\u7ba1\u7406","text":""},{"location":"lab2/#421-slab","title":"4.2.1 \u4ec0\u4e48\u662f slab \uff1f","text":"<p>slab \u662f Linux \u5185\u6838\u7684\u5185\u5b58\u7ba1\u7406\u7ec4\u4ef6\uff0c\u5b83\u7528\u4e8e\u7ed9 Linux \u5185\u6838\u4e2d\u7684\u5bf9\u8c61\u5206\u914d\u5185\u5b58\uff0c\u6240\u8c13\u5bf9\u8c61\u5c31\u662f Linux \u5185\u90e8\u7684\u6570\u636e\u7ed3\u6784\uff08task_struct\uff0ctty_struct \u7b49\uff09\u3002</p>"},{"location":"lab2/#422-slab","title":"4.2.2 slab\u5206\u914d\u673a\u5236","text":"<p>\u5f53\u5728\u5185\u6838\u4e2d\u8c03\u7528 kmalloc \u65f6\uff08\u5176\u529f\u80fd\u7c7b\u4f3c\u7528\u6237\u7a7a\u95f4\u7684malloc\uff0c\u5206\u914d\u4e00\u6bb5\u7ed9\u5b9a\u5927\u5c0f\u7684\u5185\u5b58\uff09\uff0c\u4f1a\u901a\u8fc7 slab \u5206\u914d\u7279\u5b9a\u7684\u5927\u5c0f\u7684\u5185\u5b58\u5757\u3002\u800c slab \u5bf9\u4e8e\u5185\u5b58\u5757\u5177\u6709\u7f13\u5b58\u673a\u5236\uff0c\u5047\u8bbe\u5185\u6838\u4e2d\u6709\u5982\u4e0b\u7684\u63a7\u5236\u6d41\uff1a</p> <pre><code>void* a = kmalloc(BUF_SIZE, GFP_KERNEL);\n// do something\nkfree(a);\n\nvoid* b = kmalloc(BUF_SIZE, GFP_KERNEL); \n</code></pre> <p>\u5373\u5185\u6838\u5148\u901a\u8fc7\u7b2c\u4e00\u884c\u4ee3\u7801\u5206\u914d\u4e86\u4e00\u5757 BUF_SIZE \u5927\u5c0f\u7684\u5185\u5b58\u5757\uff0c\u5e76\u5c06\u5185\u5b58\u5757\u5730\u5740\u8d4b\u7ed9\u6307\u9488 a\uff0c\u968f\u540e\u91ca\u653e\u4e86\u6307\u9488 a \u6240\u6307\u5411\u7684\u5185\u5b58\u5757\uff0cslab\u5206\u914d\u5668\u4f1a\u5c06\u5176\u653e\u5165\u4e00\u4e2a <code>kmem_cache</code> \u7f13\u5b58\u4e2d\uff0c\u8be5\u7f13\u5b58\u5185\u7684\u5185\u5b58\u5757\u5927\u5c0f\u90fd\u4e3a BUF_SIZE \u5927\u5c0f\u3002\u968f\u540e\u5185\u6838\u518d\u6b21\u5206\u914d\u4e00\u5757\u540c\u6837\u5927\u5c0f\u7684\u5185\u5b58\u5757\uff0c\u5176\u4f1a\u5c06\u521a\u91ca\u653e\u7684\u8fd9\u5757\u5185\u5b58\u5757\u5206\u914d\u51fa\u53bb\u3002</p>"},{"location":"lab2/#43-linux","title":"4.3  Linux \u8bbe\u5907\u53ca\u8bbe\u5907\u9a71\u52a8","text":"<p>\u5728 Linux \u4e2d <code>/dev</code> \u76ee\u5f55\u4e0b\uff0c\u5b58\u5728\u5f88\u591a\u8bbe\u5907\u6587\u4ef6\uff0c\u5176\u4e2d\u6709\u4e00\u4e2a <code>/dev/ptmx</code>\u8bbe\u5907\uff0c\u8fd9\u4e2a\u8bbe\u5907\u6587\u4ef6\u4e3b\u8981\u7528\u4e8e\u6253\u5f00\u4e00\u5bf9\u4f2a\u7ec8\u7aef\u8bbe\u5907\uff0c\u672c\u6b21\u5b9e\u9a8c\u5229\u7528\u8be5\u8bbe\u5907\u8fdb\u884c\u63a7\u5236\u6d41\u7684\u52ab\u6301\u3002</p> <p>\u53ef\u80fd\u9700\u8981\u7684\u5934\u6587\u4ef6\uff1a</p> <pre><code>#include&lt;stdio.h&gt; \n#include &lt;stdlib.h&gt; \n#include &lt;string.h&gt; \n#include &lt;unistd.h&gt; \n#include &lt;sys/stat.h&gt; \n#include &lt;sys/types.h&gt;\n#include &lt;fcntl.h&gt; \n#include &lt;sys/ioctl.h&gt; \n</code></pre>"},{"location":"lab2/#431-devptmx-tty_struct","title":"4.3.1 /dev/ptmx \u4f2a\u7ec8\u7aef\u548c tty_struct \u7ed3\u6784\u7684\u5229\u7528","text":"<p>\u8fdb\u7a0b\u6253\u5f00 <code>/dev/ptmx</code> \u8bbe\u5907\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u4ee3\u7801 <code>open(\"/dev/ptmx\", O_RDWR | O_NOCTTY)</code> \u6253\u5f00\uff0c\u5f53\u6211\u4eec\u6267\u884c\u8be5\u4ee3\u7801\u65f6\uff0c\u5185\u6838\u4f1a\u901a\u8fc7\u4ee5\u4e0b\u51fd\u6570\u8c03\u7528\u94fe\uff0c\u5206\u914d\u4e00\u4e2a <code>tty_struct</code> \u7ed3\u6784\u4f53\uff1a</p> <pre><code>ptmx_open (drivers/tty/pty.c)\n-&gt; tty_init_dev (drivers/tty/tty_io.c)\n  -&gt; alloc_tty_struct (drivers/tty/tty_io.c)\n</code></pre> <p><code>tty_struct</code> \u7684\u7ed3\u6784\u53ef\u4ee5\u53c2\u8003\u94fe\u63a5\u6240\u793a,\u57285.15\u7248\u672c\u7684\u5185\u6838\u4e2d\uff0c\u5176\u5927\u5c0f\u4e3a <code>0x2B8</code>(696\u5b57\u8282) \u5927\u5c0f\u3002</p> <p>\u5176\u4e2d\u7b2c5\u4e2a\u5b57\u6bb5\u4e3a <code>const struct tty_operations *ops</code>,\u7ed3\u6784\u4f53 <code>tty_operations</code>\u53ef\u53c2\u8003\u94fe\u63a5\uff0c\u8be5\u7ed3\u6784\u4f53\u5b9e\u9645\u4e0a\u662f\u591a\u4e2a\u51fd\u6570\u6307\u9488\u7684\u96c6\u5408\u3002\u5728\u6253\u5f00\u4e86\u8bbe\u5907\u7ec8\u7aef\u4e4b\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\uff0c\u8c03\u7528\u8be5\u7ed3\u6784\u4f53\u4e2d\u7684\u51fd\u6570\uff0c\u4e0b\u9762\u4ee3\u7801\u7ed9\u4e86\u4e00\u4e2a\u4f7f\u7528\u8bbe\u5907\u7684 demo :</p> <pre><code>... //some head file &amp;&amp; main struct\nfd = open(\"/dev/ptmx\", O_RDWR | O_NOCTTY); //open a dev\nerr = read(fd, &amp;buf, count);\nif(err &lt; 0)\n{\n  // read err\n}\nerr = write(fd, &amp;buf, count);\nif(err &lt; 0)\n{\n  // write err\n}\nerr = ioctl(fd, cmd, &amp;arg);\nif(err &lt; 0)\n{\n  // ioctl err\n}\nclose(fd);\n</code></pre>"},{"location":"lab2/#432-ioctl","title":"4.3.2 \u5229\u7528 ioctl \u63a7\u5236\u5bc4\u5b58\u5668","text":"<pre><code>`tty_operations` \u7ed3\u6784\u4f53\u4e2d\u6709\u4e00\u4e2a ioctl \u51fd\u6570\uff0c\u5176\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u6240\u5bf9\u5e94\u7ec8\u7aef\u8bbe\u5907\u7684 tty_struct \u7ed3\u6784\u4f53\u6307\u9488\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u548c\u7b2c\u4e09\u4e2a\u53c2\u6570\u5206\u522b\u662f \u547d\u4ee4\u53f7(cmd) \u548c \u53c2\u6570\u6240\u5728\u5730\u5740(arg) \u5982\u4e0b\u6240\u793a\uff1a\n</code></pre> <pre><code>    int  (*ioctl)(struct tty_struct *tty,\n            unsigned int cmd, unsigned long arg);\n</code></pre> <pre><code>\u540c\u65f6\u7528\u6237\u6001\u7a0b\u5e8f\u4e2d ioctl \u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u539f\u578b\u548c\u8c03\u7528\u65b9\u5f0f\u5982\u4e0b\u6240\u793a\uff1a\n</code></pre> <pre><code>//\u51fd\u6570\u539f\u578b\uff1a\nint ioctl (int __fd, unsigned long int __request, ...)\n//\u8c03\u7528\u65b9\u5f0f\uff1a\n#include &lt;sys/ioctl.h&gt;\nerr = ioctl(fd, cmd, &amp;arg);\n</code></pre> <pre><code>\u53ef\u4ee5\u53d1\u73b0\u7528\u6237\u6001\u8c03\u7528 ioctl \u65f6\u4f1a\u5c06 cmd \u548c arg \u4e24\u4e2a\u53c2\u6570\u539f\u5c01\u4e0d\u52a8\u5730\u4f20\u9012\u7ed9\u5185\u6838\u4e2d\u7684 ioctl\uff0c\u800c ARM64 \u67b6\u6784\u4e0b\u51fd\u6570\u8c03\u7528\u7684\u53c2\u6570\u5b58\u653e\u5728 x0, x1, x2...... \u5bc4\u5b58\u5668\u4e2d\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539\u7528\u6237\u6001 ioctl \u7684\u53c2\u6570\uff0c\u4ece\u800c\u63a7\u5236 x1, x2 \u4e24\u4e2a\u5bc4\u5b58\u5668\uff0c\u5e76\u5229\u7528\u8fd9\u4e24\u4e2a\u5bc4\u5b58\u5668\u548c\u5185\u6838\u4e2d\u4e00\u4e9b gadget\uff0c\u53ef\u4ee5\u8fdb\u800c\u63a7\u5236\u66f4\u591a\u7684\u5bc4\u5b58\u5668\uff0c\u4ece\u800c\u4fbf\u53ef\u4ee5\u6784\u9020\u51fd\u6570\u7684\u53c2\u6570\u8fdb\u884c\u8c03\u7528\u3002\u4f8b\u5982\uff1a\u5047\u5982\u5185\u6838\u4e2d\u5b58\u5728`mov x1, x0` \u7684\u4ee3\u7801\u7247\u6bb5\uff0c\u7531\u4e8e x1 \u5bc4\u5b58\u5668\u662f\u6211\u4eec\u6240\u63a7\u5236\u7684\uff0c\u800c\u6267\u884c\u8be5\u4ee3\u7801\u7247\u6bb5\u4e4b\u540e\uff0cx0 \u5bc4\u5b58\u5668\u5185\u5bb9\u6211\u4eec\u4e5f\u53ef\u4ee5\u63a7\u5236\u3002\n</code></pre> <p>\u4e3a\u4e86\u63a7\u5236ioctl\u51fd\u6570\uff0c\u5982\u679c\u6211\u4eec\u80fd\u591f\u63a7\u5236\u5176\u6240\u5728\u7ed3\u6784\u4f53 <code>tty_operation</code>,\u6216\u8005\u6784\u9020\u4e00\u4e2a\u5047\u7684 <code>tty_operation</code> \u7ed3\u6784\u4f53\uff0c\u5e76\u63a7\u5236 <code>tty_struct</code>\u7ed3\u6784\u4f53\uff0c\u5c06\u5176\u4e2d <code>tty_operation</code> \u6210\u5458\u5bf9\u5e94\u7684\u6307\u9488\u7be1\u6539\u6210\u6211\u4eec\u6784\u9020\u7684\u5047\u7684\u7ed3\u6784\u4f53\u5730\u5740\uff0c\u8fd9\u6837\u5f53\u6211\u4eec\u5728\u7528\u6237\u6001\u6267\u884c <code>ioctl</code> \u51fd\u6570\u65f6\uff0c\u4fbf\u53ef\u4ee5\u8df3\u8f6c\u6267\u884c\u5230\u6211\u4eec\u60f3\u8981\u6267\u884c\u7684\u5730\u5740\u3002</p>"},{"location":"lab2/#44-jop","title":"4.4 JOP \u57fa\u7840","text":"<p>JOP(\u53c2\u8003\u8bba\u6587 ) \u653b\u51fb\u662f\u7c7b\u4f3cROP\u653b\u51fb\u7684\u4e00\u79cd\uff0c\u53ea\u4e0d\u8fc7ROP\u901a\u8fc7\u5728\u6808\u4e0a\u6784\u9020\u8fd4\u56de\u5730\u5740\u6765\u5f62\u6210\u653b\u51fb\u94fe\uff0c\u800cJOP\u653b\u51fb\u4e0d\u9700\u8981\u5229\u7528\u6808\uff0c\u53ef\u4ee5\u4f7f\u7528\u8df3\u8f6c\u7684\u65b9\u5f0f\u6765\u8fdb\u884c\u653b\u51fb\uff0cx86 \u4e0b\u662f\u901a\u8fc7 <code>jmp</code> \u6307\u4ee4(\u53c2\u8003\u94fe\u63a5)\uff0cARM \u4e0a\u901a\u8fc7 <code>BR/BLR</code> \u6307\u4ee4(\u53c2\u8003\u94fe\u63a5)\u3002\u5f53JOP\u8df3\u8f6c\u7684\u6307\u4ee4\u4ee5 ret \u6307\u4ee4\u7ed3\u5c3e\uff0c\u5176\u4e5f\u80fd\u8f6c\u5316\u6210 ROP \u653b\u51fb\u3002</p>"},{"location":"lab2/#45-cred-root","title":"4.5 \u5229\u7528 cred \u7ed3\u6784\u4f53\u83b7\u53d6 root \u6743\u9650","text":"<p>\u4ece user \u83b7\u53d6 root \u6743\u9650\u7684\u65b9\u5f0f\u6709\u5f88\u591a\uff0c\u672c\u5b9e\u9a8c\u6d89\u53ca\u5229\u7528 cred \u7ed3\u6784\u4f53\u83b7\u53d6 root \u6743\u9650\u7684\u65b9\u5f0f\uff0c\u66f4\u591a\u65b9\u5f0f\u53ef\u4ee5\u53c2\u8003 github\u9879\u76ee \u6216\u8005\u6d4f\u89c8\u5668\u641c\u7d22\u5f15\u64ce\u641c\u7d22\u5173\u952e\u5b57 <code>linux kernel exploitation</code> \u8fdb\u884c\u4e86\u89e3\u3002</p>"},{"location":"lab2/#451-struct-cred","title":"4.5.1 struct cred\u7684\u4f5c\u7528","text":"<p>linux kernel \u8bb0\u5f55\u4e86\u6bcf\u4e00\u4e2a\u8fdb\u7a0b\u7684\u6743\u9650\uff0c\u662f\u7528 cred \u7ed3\u6784\u4f53\u8bb0\u5f55\u7684\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u4e2d\u90fd\u6709\u4e00\u4e2a cred \u7ed3\u6784\uff0c\uff08 Linux \u7528 task_struct \u7ed3\u6784\u6765\u7ba1\u7406\u6bcf\u4e2a\u8fdb\u7a0b\uff0c\u8be5\u7ed3\u6784\u4f53\u4e2d\u6709\u4e2a cred \u7c7b\u578b\u7684\u6307\u9488\u6210\u5458\uff09\u8fd9\u4e2a\u7ed3\u6784\u4fdd\u5b58\u4e86\u8be5\u8fdb\u7a0b\u7684\u6743\u9650\u7b49\u4fe1\u606f\uff08uid\uff0cgid \u7b49\uff09\uff0c\u5982\u679c\u80fd\u4fee\u6539\u67d0\u4e2a\u8fdb\u7a0b\u7684 cred\uff0c\u90a3\u4e48\u4e5f\u5c31\u4fee\u6539\u4e86\u8fd9\u4e2a\u8fdb\u7a0b\u7684\u6743\u9650\u3002</p> <p>\u6240\u4ee5\u5982\u679c\u80fd\u591f\u83b7\u53d6\u5230\u5f53\u524d\u8fdb\u7a0b\u7684 task_struct \u7ed3\u6784\u7684\u5730\u5740\uff0c\u5e76\u901a\u8fc7\u504f\u79fb\u83b7\u53d6\u5230\u76f8\u5e94\u7684 cred_struct \u7684\u5730\u5740\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u76f4\u63a5\u4fee\u6539\u5185\u5b58\u7684\u65b9\u5f0f\uff0c\u5c06 cred \u4e2d\u7684 uid \u548c gid \u7b49\u5b57\u6bb5\u90fd\u8bbe\u7f6e\u62100\uff0c\u4ece\u800c\u5f53\u524d\u8fdb\u7a0b\u5373\u53d8\u6210\u4e86 root \u6743\u9650\u3002\u6b64\u79cd\u65b9\u5f0f\u8f83\u4e3a\u56f0\u96be\u4f46\u662f\u53ef\u884c\uff0c\u5b66\u751f\u53ef\u4ee5\u81ea\u884c\u5c1d\u8bd5\u3002</p> <p>\u540c\u65f6\u5728kernel\u6709\u4e24\u4e2a\u51fd\u6570\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u4fee\u6539\u8fdb\u7a0b\u7684\u6743\u9650\uff1a</p> <ul> <li>struct cred* prepare_kernel_cred(struct task_struct* daemon)</li> <li>int commit_creds(struct cred *new)</li> </ul> <p>\u5f53\u7ed9 <code>prepare_kernel_cred()</code> \u51fd\u6570\u4f20\u9012\u4e00\u4e2aNULL\u53c2\u6570\u65f6\uff0c\u8be5\u51fd\u6570\u4f1a\u6784\u9020\u4e00\u4e2a kernel \u6743\u9650\u7684 cred \u7ed3\u6784\u4f53\uff0c\u5373 uid=0\uff0cgid=0\uff0c\u5e76\u8fd4\u56de\u8be5\u7ed3\u6784\u4f53\u5730\u5740\u3002\u968f\u540e\u53ef\u4ee5\u628a\u8be5\u7ed3\u6784\u4f53\u5730\u5740\u4f5c\u4e3a\u53c2\u6570\u4f20\u7ed9 <code>commit_creds</code> \u51fd\u6570,\u5373 <code>commit_creds(prepare_kernel_cred(0))</code>\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u628a\u5f53\u524d\u8fdb\u7a0b\u7684\u6743\u9650\u6539\u4e3a root \u6743\u9650\u3002</p>"},{"location":"lab2/#5","title":"5 \u5b9e\u9a8c\u4ecb\u7ecd","text":"<p>\u672c\u6b21\u5b9e\u9a8c\u865a\u62df\u673a\u5185\u63d0\u4f9b\u7684\u6587\u4ef6\uff1a</p> <pre><code>user@user-Super-Server:~/Desktop/experiment$ tree\n.\n\u251c\u2500\u2500 qemu.sh\n\u251c\u2500\u2500 rootfs.img\n\u2514\u2500\u2500 vmlinux\n\n0 directories, 3 files\n</code></pre> <p>\u5176\u4e2d qemu.sh \u662f\u8fd0\u884c qemu \u7684\u811a\u672c\uff0crootfs.img \u4e3a\u6587\u4ef6\u7cfb\u7edf\u955c\u50cf\uff0cvmlinux \u4e3a\u672a\u538b\u7f29\u7684\u5185\u6838\u3002\u53ef\u4ee5\u5229\u7528 gdb-multiarch \u548c qemu \u5bf9vmlinux \u8fdb\u884c\u8c03\u8bd5\u3002</p> <p>\u540c\u65f6\u63d0\u4f9b\u4e86\u6709 BUG \u7684\u8bbe\u5907\u9a71\u52a8\u4ee3\u7801\uff0c\u540c\u5b66\u4eec\u53ef\u4ee5\u81ea\u884c\u67e5\u770b\u3002</p>"},{"location":"lab2/#51","title":"5.1 \u5b9e\u9a8c\u73af\u5883\u642d\u5efa","text":"<p>\u901a\u8fc7\u6d59\u5927\u4e91\u76d8\u94fe\u63a5\u6216\u767e\u5ea6\u7f51\u76d8\u94fe\u63a5\u4e0b\u8f7d\u672c\u6b21\u5b9e\u9a8c\u538b\u7f29\u5305\uff0c\u5e76\u89e3\u538b\u5230lab1\u7684 virtual box \u5b9e\u9a8c\u955c\u50cf\u4e2d\u3002</p> <p>\u89e3\u538b\u4e4b\u540e\u8def\u5f84\u5982\u4e0b</p> <pre><code>syssec@VM:~/lab2$ tree\n.\n\u251c\u2500\u2500 kernel\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 cfi\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 Image\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 System.map\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 uafdriver.c\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 vmlinux\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 nocfi\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 drivers\n\u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 misc\n\u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u2514\u2500\u2500 uafdriver.c\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 Image\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 System.map\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 vmlinux\n\u251c\u2500\u2500 qemu.sh\n\u2514\u2500\u2500 rootfs.img\n\n5 directories, 10 files\n</code></pre> <p>\u4e3b\u8981\u5b9e\u9a8c\u5728 <code>nocfi</code> \u6587\u4ef6\u5939\u4e2d\u8fdb\u884c\u3002\u5176\u4e2d <code>uafdriver.c</code> \u4e3a\u5305\u542b UAF bug \u7684\u9a71\u52a8\u6587\u4ef6\uff0c\u53ef\u4ee5\u901a\u8fc7\u67e5\u770b\u5176\u6e90\u7801\u7406\u89e3 UAF \u6f0f\u6d1e\u539f\u7406\u3002</p> <p>\u6ce8\u610f\u26a0\ufe0f\uff1a\u672c\u6b21\u5b9e\u9a8c\u73af\u5883\u65e2\u6ca1\u6709KASLR\u4e5f\u6ca1\u6709SMAP\u9632\u62a4</p> <p>\u6211\u4eec\u63d0\u4f9b\u4e86\u7f16\u8bd1\u597d\u7684\u5185\u6838\u955c\u50cf(Image)\u548cgdb\u8c03\u8bd5\u7528\u7684vmlinux\uff08symbol\u53ef\u80fd\u4f1a\u6709\u95ee\u9898\uff09\u3002\u4e5f\u53ef\u4ee5\u5c1d\u8bd5\u81ea\u5df1\u5c06 <code>uafdriver.c</code> \u9a71\u52a8\u653e\u5230lab1\u6240\u5728\u7684\u5185\u6838\u6e90\u7801\u4e2d(<code>drivers/misc/</code> \u8def\u5f84\u4e0b)\uff0c\u518d\u4fee\u6539\u540c\u6587\u4ef6\u5939\u4e0b\u7684 <code>Makefile</code>\uff0c\u589e\u52a0\u4e00\u884c</p> <pre><code>obj-y          +=      uafdriver.o\n</code></pre> <p>\u7136\u540e\u91cd\u65b0\u4ea4\u53c9\u7f16\u8bd1\u5185\u6838\u6e90\u7801\u5373\u53ef\u3002 \uff08\u8fd9\u6837\u80fd\u591f\u65b9\u4fbfgdb\u8c03\u8bd5\uff0c\u770b\u5230\u6267\u884c\u6d41\u548c\u5bf9\u5e94\u7684c\u4ee3\u7801\uff0c\u76f4\u63a5\u8fd0\u884c qemu \u811a\u672c\u4e5f\u662f\u53ef\u4ee5\u7684\uff09</p> <p>\u76f4\u63a5\u8fd0\u884c qemu \u811a\u672c\uff0c\u5e76\u8f93\u5165\u7528\u6237\u540d\u4e0e\u5bc6\u7801\u8fdb\u5165\u5b9e\u9a8c\u73af\u5883\uff0c\u53ef\u4ee5\u5728 qemu \u865a\u62df\u673a\u5185\u90e8\u76f4\u63a5\u901a\u8fc7vim\u7f16\u5199PoC\uff0c\u5e76\u901a\u8fc7gcc\u8fdb\u884c\u7f16\u8bd1\uff0cgdb\u8fdb\u884c\u8c03\u8bd5\u3002</p> <pre><code>sh qemu.sh\n\nusername\uff1aubuntu\npassword\uff1a123\n</code></pre>"},{"location":"lab2/#52-zjudev","title":"5.2 zjudev\u63a5\u53e3","text":"<p>\u672c\u5b9e\u9a8c\u5728 <code>/dev/</code>\u76ee\u5f55\u4e0b\u63d0\u4f9b\u4e00\u4e2a <code>zjudev</code> \u7684\u8bbe\u5907\uff0c\u8be5\u8bbe\u5907\u5728\u5185\u6838\u7ef4\u62a4\u4e00\u4e2a\u7ed3\u6784\u4f53\u4f5c\u4e3a\u5b57\u7b26\u8bbe\u5907\u7f13\u51b2\u533a\uff0c\u8bbe\u5907\u7f13\u51b2\u533a\u5982\u4e0b\u6240\u793a\uff0c\u5176\u4e2d <code>dev_buf</code> \u5b57\u6bb5\u4e3a\u6253\u5f00\u7684\u8bbe\u5907\u5206\u914d\u7f13\u51b2\u533a\uff0c<code>buf_len</code> \u5b57\u6bb5\u4e3a\u7f13\u51b2\u533a\u5927\u5c0f\uff08\u4e3a\u4e86\u9632\u6b62\u7f13\u51b2\u533a\u6ea2\u51fa\uff0c\u5b9e\u9645\u53ea\u80fd\u4f7f\u7528 <code>buf_len - 1</code>\uff09\uff1a</p> <pre><code>struct zjudev_struct\n{\n    char *dev_buf;\n    size_t buf_len;\n} zjudev;\n</code></pre> <p>\u540c\u65f6\u8be5\u8bbe\u5907\u5411\u7528\u6237\u66b4\u9732\u4e86\u51e0\u4e2a\u5173\u952e\u63a5\u53e3\uff1a</p> <ul> <li> <p>open\uff1a</p> </li> <li> <p>\u529f\u80fd\uff1a\u6253\u5f00 <code>zjudev</code> \u8bbe\u5907\uff0c\u5728\u5185\u6838\u4e2d\u4e3a\u8be5\u8bbe\u5907\u5206\u914d64\u5b57\u8282\u7684\u7f13\u51b2\u533a\u5927\u5c0f\u3002</p> </li> <li> <p>\u7528\u6237\u6001\u4f7f\u7528\u8303\u4f8b\uff1a</p> <p><pre><code>int fd;\nfd = open(\"/dev/zjudev\", O_RDWR); //\u6253\u5f00\u8bbe\u5907\uff0c\u6743\u9650\u4e3aread/write\uff0c\u5e76\u8fd4\u56defd\u4f5c\u4e3a\u6587\u4ef6\u53e5\u67c4\u3002\uff08linux\u4e07\u7269\u7686\u6587\u4ef6\uff09\n</code></pre> * read\uff1a</p> </li> <li> <p>\u529f\u80fd\uff1a\u8bfb\u53d6\u5185\u6838\u7f13\u51b2\u533a\u4e2d\u89c4\u5b9a\u957f\u5ea6\u7684\u5185\u5bb9\uff0c\u4f46\u662f\u957f\u5ea6\u5c0f\u4e8e <code>buf_len</code>\u3002</p> </li> <li> <p>\u7528\u6237\u6001\u4f7f\u7528\u8303\u4f8b\uff1a</p> <p><pre><code>char *buf = (char*) malloc(1024);\nread(fd, buf, 40);//\u4ece\u8bbe\u5907\u4e2d\u8bfb\u53d640\u5b57\u8282\u5230buf\u5b57\u7b26\u6570\u7ec4\u4e2d\n</code></pre> * write\uff1a</p> </li> <li> <p>\u529f\u80fd\uff1a\u5199\u5165\u4e00\u5b9a\u957f\u5ea6\u7684\u5185\u5bb9\u5230\u5185\u6838\u7f13\u51b2\u533a\u4e2d\uff0c\u4f46\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7\u5185\u6838\u7f13\u51b2\u533a\u5927\u5c0f\u3002</p> </li> <li> <p>\u7528\u6237\u6001\u4f7f\u7528\u8303\u4f8b\uff1a</p> <p><pre><code>char *buf = \"hello, world!\";\nwrite(fd, buf, sizeof(buf)); //\u5c06buf\u6570\u7ec4\u7684\u5185\u5bb9\u5199\u5165\u8bbe\u5907\u7f13\u51b2\u533a\n</code></pre> * ioctl:</p> </li> <li> <p>\u529f\u80fd\uff1a\u5229\u7528\u547d\u4ee4\u63a7\u5236\u8bbe\u5907\uff0c\u672c\u5b9e\u9a8c\u63d0\u4f9b\u547d\u4ee4\u53f7\u4e3a <code>0x0001</code> \u7684\u547d\u4ee4\uff0c\u8be5\u529f\u80fd\u4e3a\u91ca\u653e\u5185\u6838\u7f13\u51b2\u533a\uff0c\u5e76\u91cd\u65b0\u5206\u914d\u4e00\u4e2a\u8981\u6c42\u5927\u5c0f\u7684\u7f13\u51b2\u533a\uff0c\u4f46\u662f\u8be5\u7f13\u51b2\u533a\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc78K\u5b57\u8282\u3002</p> </li> <li> <p>\u7528\u6237\u6001\u4f7f\u7528\u8303\u4f8b\uff1a</p> <p><pre><code>ioctl(fd, 0x0001, BUF_SIZE); //\u5176\u4e2d0x0001\u4e3a\u547d\u4ee4\u53f7\uff0cBUF_SIZE\u4e3a\u8981\u6c42\u7684\u5185\u6838\u7f13\u51b2\u533a\u5927\u5c0f\u3002\n</code></pre> * close:</p> </li> <li> <p>\u529f\u80fd:\u5173\u95ed\u8be5\u8bbe\u5907\uff0c\u91ca\u653e\u5185\u6838\u7f13\u51b2\u533a\u3002</p> </li> <li> <p>\u7528\u6237\u6001\u4f7f\u7528\u8303\u4f8b\uff1a</p> <pre><code>close(fd); //\u901a\u8fc7close\u7cfb\u7edf\u8c03\u7528\u5173\u95ed\u6587\u4ef6\u53e5\u67c4\u3002\n</code></pre> </li> </ul> <p>\u6211\u4eec\u4ee3\u7801\u4e2d\u5199\u4e86\u6709printk\u6253\u5370\uff0c\u4f46\u5176\u53ef\u80fd\u5e76\u4e0d\u4f1a\u88ab\u76f4\u63a5\u6253\u5370\u663e\u793a\uff0c\u89e3\u51b3\u529e\u6cd5\u6709\u4e24\u79cd</p> <ul> <li>\u4f7f\u7528dmesg\u547d\u4ee4\u67e5\u770b</li> <li>\u5982\u679c\u4f60~~\u8d22\u529b~~\u65f6\u95f4~~\u96c4\u539a~~\u5145\u8db3\uff0c\u53ef\u4ee5\u7ed9printk\u52a0\u5165\u8bf8\u5982KERN_EMERG/ALERT\u7684\u53c2\u6570\u7136\u540e\u91cd\u65b0\u7f16\u8bd1kernel\u624d\u80fd\u5728\u547d\u4ee4\u884c\u76f4\u63a5\u663e\u793aprintk\u7684\u6d88\u606f\uff1a  <code>printk(KERN_EMERG \u201chalo~~\\n\u201d);</code></li> </ul>"},{"location":"lab2/#53-uaf","title":"5.3 UAF\u6f0f\u6d1e\u4ecb\u7ecd","text":"<p>\u7531\u4e8e\u5185\u6838\u4e2d\u8be5\u8bbe\u5907\u53ea\u6709\u5168\u5c40\u4e00\u4e2a\u7f13\u51b2\u533a\uff0c\u5982\u679c\u5c06\u8bbe\u5907\u6253\u5f00\u4e24\u6b21\uff0c\u7b2c\u4e8c\u6b21\u6253\u5f00\u7684\u8bbe\u5907\u4f1a\u8986\u76d6\u7b2c\u4e00\u6b21\u6253\u5f00\u8bbe\u5907\u7684\u7f13\u51b2\u533a\uff0c\u4e14\u4e24\u6b21\u6253\u5f00\u8bbe\u5907\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u83b7\u5f97\u6307\u5411\u540c\u4e00\u4e2a\u8bbe\u5907\u7f13\u51b2\u533a\u7684\u4e24\u4e2a\u6307\u9488\u3002\u6b64\u65f6\u5982\u679c\u91ca\u653e\u5176\u4e2d\u4e00\u4e2a\u8bbe\u5907\uff0c\u7531\u4e8e\u5728\u91ca\u653e\u7684\u65f6\u5019\u6307\u9488\u6ca1\u6709\u7f6e\u7a7a\uff0c\u6b64\u65f6\u4fbf\u53ef\u4ee5\u901a\u8fc7\u53e6\u4e00\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\u64cd\u4f5c\u8be5\u7f13\u51b2\u533a\u5bf9\u5e94\u7684\u5185\u5b58\uff0c\u5373\u5b58\u5728 UAF \u6f0f\u6d1e\u3002</p> <p>\u540c\u65f6\u5b9e\u9a8c\u63d0\u4f9b\u7684 ioctl \u63a5\u53e3\u80fd\u591f\u8c03\u6574\u8fd9\u4e2a\u7f13\u51b2\u533a\u5927\u5c0f\u5982\u679c\u5c06\u5176\u8c03\u6574\u6210\u5185\u6838\u4e2d\u67d0\u4e2a\u6570\u636e\u7ed3\u6784\u7684\u5927\u5c0f\uff0c\u5f53\u5185\u6838\u5206\u914d\u76f8\u540c\u5927\u5c0f\u7684\u6570\u636e\u7ed3\u6784\u65f6\uff0c\u4fbf\u4f1a\u4f7f\u7528\u8fd9\u5757\u7531\u6211\u4eec\u63a7\u5236\u7684\u7f13\u51b2\u533a\uff0c\u7531\u6b64\u6211\u4eec\u4fbf\u53ef\u4ee5\u63a7\u5236\u5185\u6838\u7684\u5173\u952e\u6570\u636e\u7ed3\u6784\uff0c\u6700\u7ec8\u8fbe\u5230 root \u6743\u9650\u7684\u76ee\u7684\u3002</p>"},{"location":"lab2/#54-struct","title":"5.4 struct\u7ed3\u6784\u4ecb\u7ecd","text":"<p><code>tty_struct</code>\uff1a</p> <pre><code>/* offset    |  size */  type = struct tty_struct {\n/*    0      |     4 */    int magic;\n/*    4      |     4 */    struct kref {\n/*    4      |     4 */        refcount_t refcount;\n\n                               /* total size (bytes):    4 */\n                           } kref;\n/*    8      |     8 */    struct device *dev;\n/*   16      |     8 */    struct tty_driver *driver;\n/*   24      |     8 */    const struct tty_operations *ops;\n/*   32      |     4 */    int index;\n/* XXX  4-byte hole  */\n/*   40      |    48 */    struct ld_semaphore {\n/*   40      |     8 */        atomic_long_t count;\n/*   48      |     4 */        raw_spinlock_t wait_lock;\n/*   52      |     4 */        unsigned int wait_readers;\n/*   56      |    16 */        struct list_head {\n/*   56      |     8 */            struct list_head *next;\n/*   64      |     8 */            struct list_head *prev;\n\n                                   /* total size (bytes):   16 */\n                               } read_wait;\n/*   72      |    16 */        struct list_head {\n/*   72      |     8 */            struct list_head *next;\n/*   80      |     8 */            struct list_head *prev;\n\n                                   /* total size (bytes):   16 */\n                               } write_wait;\n...\n</code></pre>"},{"location":"lab2/#6","title":"6 \u5b9e\u9a8c\u4efb\u52a1","text":"<p>\u672c\u6b21\u5b9e\u9a8c\u5206\u4e3a\u4e09\u4e2a\u5c0f\u4efb\u52a1\uff0c\u6bcf\u4e2a\u5c0f\u4efb\u52a1\u96be\u5ea6\u9010\u5c42\u9012\u8fdb\uff0c\u5b9e\u9a8c\u6700\u7ec8\u8981\u6c42\u662f\u83b7\u53d6 root \u6743\u9650\u4e0b\u53ef\u8bfb\u6587\u4ef6\u4e2d\u7684 flag\uff0c\u5e76\u5199\u5165\u81ea\u5df1\u7684\u5b9e\u9a8c\u62a5\u544a\u4e2d\u63d0\u4ea4\u3002\u672c\u6b21\u5b9e\u9a8c\u53ef\u80fd\u4f1a\u6d89\u53ca ASLR\uff0c\u4e3a\u4e86\u7b80\u5316\u5b9e\u9a8c\uff0c\u672c\u6b21\u5b9e\u9a8c\u63d0\u4f9b\u4e86 gdb \u548c System.map \u6587\u4ef6\uff0c\u53ef\u4ee5\u95f4\u63a5\u7ed5\u8fc7\u3002</p>"},{"location":"lab2/#61-task1","title":"6.1 Task1\uff1a\u8bbe\u5907\u63a5\u53e3\u7684\u4f7f\u7528\u3002","text":"<ul> <li>\u7f16\u5199\u7a0b\u5e8f\uff0c\u5c1d\u8bd5\u4f7f\u7528\u8bbe\u5907\u63a5\u53e3\u3002</li> <li>\u5c1d\u8bd5\u5229\u7528\u7ae0\u82825.2\u7684\u4ecb\u7ecd\u89e6\u53d1 UAF \u6f0f\u6d1e\uff0c\u5e76\u5229\u7528\u7ae0\u82824.4\u6240\u63d0\u7684 <code>/dev/ptmx</code>\u8bbe\u5907(\u6253\u5f00\u8be5\u8bbe\u5907\u5185\u6838\u4f1a\u5206\u914d\u4e00\u4e2a <code>tty_struct</code>\u7ed3\u6784\u4f53, \u4f46\u662f\u56e0\u4e3a Linux \u591a\u6838\u7684\u5173\u7cfb\uff0c\u53ef\u80fd\u9700\u8981\u5806\u55b7\u6280\u672f\uff0c\u591a\u6b21\u6253\u5f00\u7ed3\u6784\u4f53\uff0c\u591a\u6b21\u5206\u914d\uff0c\u76f4\u5230\u5206\u914d\u5230\u6211\u4eecUAF\u6307\u9488\u6240\u63a7\u5236\u7684\u90a3\u5757\u5185\u5b58\u7a7a\u95f4\u4e3a\u6b62)\uff0c\u5c1d\u8bd5\u63a7\u5236\u4e00\u4e2a <code>tty_struct</code> \u7ed3\u6784\u4f53\uff0c\u5e76\u4e14\u80fd\u591f\u8bfb\u53d6\u548c\u4fee\u6539\u6240\u63a7\u5236\u7684 <code>tty_struct</code> \u7ed3\u6784\u4f53\u7684\u5185\u5bb9\u3002\uff08\u89e6\u53d1\u8fc7\u7a0b\u53ef\u80fd\u4f1a\u9020\u6210 kernel crash\uff0c\u91cd\u542f qemu \u5373\u53ef\uff09\u3002</li> </ul> <p>\u63d0\u793a\ud83c\udf1f\uff1a\u540c\u4e00\u4e2a\u8bbe\u5907\u7b26\u88abclose\u4e4b\u540e\u5c31\u4e0d\u8981\u518d\u4f7f\u7528read\u7b49\u51fd\u6570\u4e86\u3002\u8fd9\u91cc\u9700\u8981\u60f3\u529e\u6cd5\u4fdd\u8bc1\u5728\u80fd\u591fclose\u7684\u60c5\u51b5\u4e0b\uff0c\u7ee7\u7eed\u8bfb\u53d6\uff0c\u8be5\u600e\u4e48\u505a\u5462\uff1f</p> <p>Question 2\uff1a\u5982\u4f55\u786e\u5b9a\u81ea\u5df1\u6240\u63a7\u5236\u7684\u6307\u9488\u4e00\u5b9a\u88ab\u5206\u914d\u7ed9 tty_struct\u7ed3\u6784\u4f53 ?</p> <p>\u63d0\u793a\uff1atty_struct \u7ed3\u6784\u4f53\u91cc\u6709\u4e9b\u5b57\u6bb5\u6bd4\u8f83\u7279\u6b8a\u3002</p>"},{"location":"lab2/#62-task2root-shell","title":"6.2 Task2\uff1a\u7b80\u5355\u83b7\u53d6root shell","text":"<p>\u4e3a\u4e86\u65b9\u4fbf\u540c\u5b66\u4eec\u83b7\u5f97 root \u6743\u9650\u7684 shell\uff0c\u672c\u5b9e\u9a8c\u5728\u5185\u6838\u4e2d\u63d0\u4f9b\u4e00\u4e2a\u9884\u5148\u8bbe\u7f6e\u7684\u51fd\u6570 <code>hack_cred</code>\uff0c\u5176\u5b9a\u4e49\u5982\u4e0b\u6240\u793a\uff0c\u53ef\u4ee5\u76f4\u63a5\u5229\u7528\u7ae0\u82824.4\u6240\u63d0\u7684 <code>/dev/ptmx</code>\u8bbe\u5907,\u60f3\u529e\u6cd5\u52ab\u6301\u63a7\u5236\u6d41\uff0c\u4f7f\u5176\u8fd0\u884c\u8be5\u51fd\u6570\u83b7\u53d6 root \u6743\u9650\u3002</p> <pre><code>int hack_cred(struct tty_struct *tty, const unsigned char *buf, int c)\n{\n    struct cred *root_cred = prepare_kernel_cred(NULL);\n    commit_creds(root_cred);\n    return -1;\n}\n</code></pre> <p>\u5177\u4f53\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ul> <li>\u5229\u7528 gdb-multiarch \u8c03\u8bd5 kernel\uff0c\u83b7\u53d6\u8be5\u51fd\u6570\u5730\u5740\u3002</li> <li>\u6839\u636e\u524d\u8ff0\u77e5\u8bc6\u548c <code>/dev/ptmx</code> \u8bbe\u5907\uff0c\u5c06 <code>/dev/zjudev</code> \u8bbe\u5907\u7684\u7f13\u51b2\u533a\u4fee\u6539\u4e3a <code>tty_struct</code>\u7ed3\u6784\u4f53\u5927\u5c0f\uff0c\u5e76\u60f3\u529e\u6cd5\u63a7\u5236\u8be5\u7ed3\u6784\u4f53\uff0c\u8bfb\u53d6\u8be5\u7ed3\u6784\u5185\u5b57\u6bb5\u3002</li> <li>\u5229\u7528 <code>write</code> \u7cfb\u7edf\u8c03\u7528\u63a7\u5236\u8be5\u7ed3\u6784\u4f53\u5185 <code>tty_operation</code> \u6210\u5458\uff0c\u5e76\u5c06\u5176\u4e2d\u67d0\u4e2a\u51fd\u6570\u6307\u9488\u5730\u5740\u4fee\u6539\u4e3a <code>hack_cred</code> \u7684\u5730\u5740</li> <li>\u5229\u7528\u7cfb\u7edf\u8c03\u7528\u89e6\u53d1\u8be5\u51fd\u6570\uff0c\u5f62\u6210\u4e00\u6b21\u8df3\u8f6c\u7684JOP\u653b\u51fb</li> </ul> <p>\u63d0\u793a\ud83c\udf1f\uff1a\u8fd9\u91cc\u6ca1\u6709\u5f00\u542fsmap\u4fdd\u62a4\uff0c\u6240\u4ee5\u5185\u6838\u53ef\u4ee5\u8bbf\u95ee\u7528\u6237\u6001\u7684\u5185\u5b58</p> <p>Question 3: \u4e3a\u4ec0\u4e48\u4e0d\u80fd\u76f4\u63a5\u901a\u8fc7 UAF \u63a7\u5236 cred \u7ed3\u6784\u4f53\u76f4\u63a5\u4fee\u6539\u5176\u5185\u5bb9\uff1f\u6709\u6ca1\u6709\u529e\u6cd5\u80fd\u591f\u901a\u8fc7 UAF \u6765\u5229\u7528\u65b0\u7248\u672c\u7684 cred \u7ed3\u6784\u4f53\u5462\uff1f</p> <p>\u63d0\u793a\uff1aprepare_kernel_cred \u51fd\u6570\u6e90\u7801\uff0c\u4ee5\u53ca linux \u5185\u6838\u5806\u5185\u5b58\u5206\u914d\u5668\u673a\u5236\u3002</p>"},{"location":"lab2/#63-task3gadget-root-shell","title":"6.3 Task3\uff1agadget \u83b7\u53d6 root shell","text":"<p>\u7b2c\u4e09\u4e2a\u5c0f\u4efb\u52a1\u5728\u7b2c\u4e8c\u4e2a\u4efb\u52a1\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u4e86\u4e00\u70b9\u96be\u5ea6\uff0c\u8981\u6c42\u4e0d\u4f7f\u7528\u6211\u4eec\u63d0\u4f9b\u7684 <code>hack_cred</code> \u51fd\u6570\uff0c\u800c\u662f\u4f7f\u7528\u96f6\u788e\u7684\u4ee5 <code>br/blr</code> \u6307\u4ee4\u7ed3\u5c3e\u7684\u6c47\u7f16\u4ee3\u7801\u7247\u6bb5\uff08\u79f0\u4e3agadget\uff09\u5b9e\u73b0\u83b7\u53d6root\u6743\u9650\u3002</p> <p>\u4e3a\u4e86\u964d\u4f4e\u5b9e\u9a8c\u96be\u5ea6\uff0c\u6211\u4eec\u63d0\u4f9b\u4e86\u4e09\u4e2agadget (\u53ef\u4ee5\u5229\u7528\u5de5\u5177\u81ea\u884c\u5728\u5185\u6838\u955c\u50cf\u4e2d\u5bfb\u627e\u53ef\u5229\u7528\u7684\u4ee3\u7801\u7247\u6bb5) \uff0c\u5982\u4e0b\u6240\u793a\u3002\u5229\u7528\u8fd9\u4e09\u4e2a gadget \u4ee5\u53ca\u524d\u8ff0\u77e5\u8bc6\uff0c\u4fee\u6539\u6211\u4eec\u6240\u63a7\u5236\u7684 <code>tty_struct</code> \u548c <code>tty_operation</code> \u7ed3\u6784\u4f53\u7684\u5185\u5bb9\uff0c\u5e76\u591a\u6b21\u4f7f\u7528 <code>tty_operation</code> \u63a5\u53e3\u83b7\u53d6\u4e00\u4e9b\u4fe1\u606f\uff0c\u5e76\u6700\u7ec8\u83b7\u5f97root\u6743\u9650\u3002</p> <pre><code>void zju_gadget1(void)\n{\n    __asm__ __volatile__ ( \n    \"ldr x1, [x0, #0x38]     \\n\\t\"\n    \"mov x0,x2     \\n\\t\"\n    \"br x1 \\n\\t\"\n    );\n}\n\n\nvoid zju_gadget2(void)\n{\n    __asm__ __volatile__ ( \n    \"mov x0,0     \\n\\t\"\n    \"ldr x1, [x2, #0x28]     \\n\\t\"\n    \"br x1 \\n\\t\"\n    );\n}\n\n\nvoid zju_gadget3(void)\n{\n    __asm__ __volatile__ ( \n    \"ret     \\n\\t\"\n    );\n}\n</code></pre> <p>\u5177\u4f53\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ul> <li>\u5229\u7528 gdb-multiarch \u83b7\u53d6\u4e09\u4e2agadget\u4ee3\u7801\u7247\u6bb5\u5730\u5740\uff0c\u4ee5\u53ca <code>prepare_kernel_cred</code> \u548c <code>commit_creds</code> \u51fd\u6570\u5730\u5740\u3002</li> <li>\u5229\u7528 <code>zju_gadget3</code>\uff0c\u83b7\u53d6 <code>tty_struct</code> \u7ed3\u6784\u4f53\u7684\u5730\u5740\u3002\uff08\u6ce8\u610f\uff1a\u8fd4\u56de\u7684\u7ed3\u6784\u4f53\u5730\u5740\u4e3a x0 \u5bc4\u5b58\u5668\u7684\u5185\u5bb9\uff0c\u4f46\u662f\u4f1a\u548c\u771f\u5b9e\u503c\u4e0d\u4e00\u6837\uff0c\u627e\u5230\u539f\u56e0\u5e76\u83b7\u53d6\u771f\u5b9e\u7684\u7ed3\u6784\u4f53\u5730\u5740\uff09</li> <li>\u5229\u7528\u5269\u4e0b\u4e24\u4e2agadget\u63a7\u5236\u5bc4\u5b58\u5668 x0\uff0cx1\uff0cx2\uff0c\u5e76\u60f3\u529e\u6cd5\u8bbe\u7f6etty operations\u6784\u9020 0 \u53c2\u6570\uff0c\u8df3\u8f6c\u6267\u884c <code>prepare_kernel_cred</code> \u51fd\u6570\uff0c\u83b7\u53d6\u5176\u8fd4\u56de\u5730\u5740\u3002</li> <li>\u5229\u7528\u5269\u4e0b\u4e24\u4e2agadget\u63a7\u5236\u5bc4\u5b58\u5668 x0\uff0cx1\uff0cx2\uff0c\u5e76\u60f3\u529e\u6cd5\u5c06x0\u5bc4\u5b58\u5668\u7684\u503c\u63a7\u5236\u6210\u4e0a\u4e00\u6b65\u6240\u83b7\u5f97\u7684cred\u7684\u5730\u5740\uff0c\u5e76\u8c03\u7528 <code>commit_creds</code> \u51fd\u6570\u3002</li> <li>\u83b7\u53d6 root shell \u4e4b\u540e\u8bfb\u53d6flag\u6587\u4ef6\u3002</li> </ul> <p>\u63d0\u793a\ud83c\udf1f\uff1a\u4e0d\u8981\u5fd8\u4e86ioctl\u7684\u53c2\u6570\u7c7b\u578b(fd, int, arg)</p> <p>Question 4:\u4e3a\u4ec0\u4e48\u7b2c\u4e8c\u6b65\u53ef\u4ee5\u76f4\u63a5ret\u83b7\u53d6\u5230 <code>tty_struct</code>\u7ed3\u6784\u4f53\u7684\u5730\u5740\uff1fret \u6267\u884c\u524d\u540e\u7684\u63a7\u5236\u6d41\u662f\u4ec0\u4e48\u6837\u7684\uff1f</p>"},{"location":"lab2/#64-task4-cfi","title":"6.4 Task4: \u5185\u6838 CFI \u4fdd\u62a4","text":"<p>\u4e3a\u4e86\u62b5\u5fa1\u4e0a\u8ff0\u52ab\u6301\u5185\u6838\u63a7\u5236\u6d41\u7684JOP\u653b\u51fb\uff0c\u5b89\u5168\u7814\u7a76\u4eba\u5458\u63d0\u51fa\u4e86\u63a7\u5236\u6d41\u5b8c\u6574\u6027\u7684\u4fdd\u62a4\u65b9\u6848\uff08Control-Flow Integrity\uff09\u3002\u76ee\u524d\u5185\u6838\u652f\u6301\u5339\u914d\u51fd\u6570\u7c7b\u578b\u7684CFI\u4fdd\u62a4\uff0c\u9700\u8981\u5229\u7528 Clang/LLVM \u7f16\u8bd1\u5668\u7f16\u8bd1\u5185\u6838\u6e90\u7801\uff0c\u6700\u540e\u5f97\u5230\u652f\u6301CFI\u7684\u5185\u6838\u955c\u50cf\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u95f4\u63a5\u8c03\u7528\uff0c\u7f16\u8bd1\u5668\u901a\u8fc7\u5339\u914d\u5176\u51fd\u6570\u6307\u9488\u548c\u51fd\u6570\u7684\u7c7b\u578b\uff0c\u63d0\u524d\u8ba1\u7b97\u51fa\u6f5c\u5728\u7684\u76ee\u6807\u51fd\u6570\u96c6\u5408\uff0c\u751f\u6210\u8df3\u8f6c\u8868\uff0c\u9650\u5236\u95f4\u63a5\u8c03\u7528\u7684\u76ee\u6807\u51fd\u6570\u5fc5\u987b\u5728\u96c6\u5408\u4e2d\u3002</p> <p>\u5b9e\u9a8c\u5185\u5bb9\u5982\u4e0b\uff1a</p> <ul> <li>\u4f7f\u7528objdump\u53cd\u6c47\u7f16\u5f00\u542fCFI\u7684\u5185\u6838\u955c\u50cf <code>vmlinux</code>\uff0c\u83b7\u5f97\u6c47\u7f16\u4ee3\u7801\uff0c\u63d0\u4ea4\u4efb\u610f\u4e00\u4e2a\u95f4\u63a5\u8c03\u7528\u7684\u6c47\u7f16\u4ee3\u7801\uff0c\u5e76\u8be6\u7ec6\u89e3\u91caCFI\u662f\u5982\u4f55\u9632\u5fa1JOP\u653b\u51fb\u3002</li> <li>\u91cd\u65b0\u8fd0\u884cJOP\u653b\u51fb\u7a0b\u5e8f\uff0c\u67e5\u770b\u662f\u5426CFI\u662f\u5426\u80fd\u8d77\u4f5c\u7528\u3002\u63d0\u4ea4dmesg\u4e2d\u5305\u542bCFI Failure\u622a\u56fe\u3002</li> </ul>"},{"location":"lab2/#7","title":"7. \u5b9e\u9a8c\u63d0\u4ea4","text":"<p>\u8bf7\u540c\u5b66\u4eec\u5728\u5b66\u5728\u6d59\u5927\u4e0a\u63d0\u4ea4\u5b9e\u9a8c\u62a5\u544a\u3002\u683c\u5f0f\u8981\u6c42\u4e3a pdf\uff0c\u547d\u540d\u4e3a\u5b66\u53f7+\u59d3\u540d+ lab2.pdf\u3002\u5b9e\u9a8c\u62a5\u544a\u9700\u8981\u5305\u542b\u4ee5\u4e0b\u5185\u5bb9\uff1a</p> <ul> <li>flag \u6587\u4ef6\u7684\u5185\u5bb9</li> <li>Task2 \u548c Task3 \u7684 PoC \u4ee3\u7801</li> <li>Task4 \u4e2d\u8981\u6c42\u63d0\u4ea4\u7684\u5185\u5bb9</li> <li>\u56de\u7b54Question1~4</li> </ul>"},{"location":"proj/","title":"Final Project \u5217\u8868\u4e0e\u8981\u6c42","text":""},{"location":"proj/#11-ebpflinuxrootkit","title":"1.1 \u5229\u7528eBPF\u5b9e\u73b0\u5bf9Linux\u5185\u6838\u7684Rootkit\u5b9e\u6218","text":"<p>\u80cc\u666f\uff1a eBPF\uff08Extended Berkeley Packet Filter\uff09\u662fLinux\u5185\u6838\u57283.18\u7248\u672c\u5f15\u5165\u7684\u4e00\u9879\u9769\u547d\u6027\u6280\u672f\u3002\u5b83\u5141\u8bb8\u7528\u6237\u5728\u4e0d\u4fee\u6539\u5185\u6838\u6e90\u7801\u6216\u52a0\u8f7d\u5185\u6838\u6a21\u5757\u7684\u60c5\u51b5\u4e0b\uff0c\u52a8\u6001\u5730\u5728\u5185\u6838\u4e2d\u52a0\u8f7d\u5e76\u6267\u884c\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u6269\u5c55\u7a0b\u5e8f\u3002eBPF\u4f9d\u9760\u5373\u65f6\u7f16\u8bd1\uff08JIT\uff09\u6280\u672f\u548c\u4e25\u683c\u7684\u9759\u6001\u9a8c\u8bc1\u673a\u5236\uff08Verifier\uff09\u6765\u4fdd\u969c\u8fd9\u4e9b\u7a0b\u5e8f\u7684\u5b89\u5168\u8fd0\u884c\u3002\u8d77\u521d\uff0c\u5b83\u4e3b\u8981\u5e94\u7528\u4e8e\u7f51\u7edc\u6570\u636e\u5305\u7684\u8fc7\u6ee4\uff0c\u4f46\u5982\u4eca\uff0c\u5176\u5e94\u7528\u8303\u56f4\u5df2\u7ecf\u62d3\u5c55\u5230\u6027\u80fd\u5206\u6790\u3001\u5b89\u5168\u76d1\u63a7\u7b49\u591a\u4e2a\u9886\u57df\u3002\u7136\u800c\uff0ceBPF\u7684\u5f3a\u5927\u529f\u80fd\u4e5f\u53ef\u80fd\u88ab\u653b\u51fb\u8005\u6240\u5229\u7528\uff1a\u5b83\u80fd\u591f\u4fee\u6539\u7528\u6237\u7a7a\u95f4\u7684\u5185\u5b58\uff0chook\u5177\u6709\u6302\u8f7d\u70b9\u7684\u5185\u6838\u51fd\u6570\uff0c\u53ef\u88ab\u5229\u7528\u6765\u66f4\u65b9\u4fbf\u7684\u5b9e\u73b0Rootkit\u3002\u540c\u65f6\uff0c\u5982\u679cVerifier\u5b58\u5728\u6f0f\u6d1e\u6216\u914d\u7f6e\u4e0d\u5f53\uff0c\u4e5f\u53ef\u80fd\u5bfc\u81f4\u5185\u6838\u63d0\u6743\u6216\u9003\u9038\u3002</p> <p>\u63cf\u8ff0\uff1a \u5229\u7528BPF\u5b9e\u73b0rootkit\uff0c\u5bf9cron\u65e0\u611f\u77e5\u5730\u63d2\u5165\u540e\u95e8\uff0c\u53ef\u4ee5\u6267\u884c\u4efb\u610f\u547d\u4ee4\u6216\u5411\u653b\u51fb\u65b9\u53d1\u8d77\u53cd\u5411\u8fde\u63a5\uff0c\u5e76\u8bbe\u8ba1\u5229\u7528BPF\u7684\uff0c\u5bf9BPF\u6076\u610f\u5229\u7528\u7684\u68c0\u6d4b\u7cfb\u7edf\u6846\u67b6(\u57fa\u4e8e\u89c4\u5219\u7684\u9762\u5411BPF syscall\u7684\u68c0\u6d4b\uff0c\u5982\u975e\u9884\u671f\u7528\u6237\u6302\u8f7d\u4e86\u654f\u611f\u7c7b\u578b\u63a2\u9488)</p> <p>\u91cc\u7a0b\u7891\uff1a</p> <ol> <li>\u7406\u89e3\u5185\u6838\u4e2dBPF\u7684\u4f5c\u7528\u539f\u7406\uff0c\u6536\u96c62\u79cd\u5df2\u6709\u7684eBPF rootkit\uff0c\u9610\u8ff0\u5176\u539f\u7406\uff08\u7efc\u8ff0\uff09\u3002</li> <li>\u6269\u5c55\u5df2\u6709eBPF rootkit\uff0c\u5b9e\u73b02\u79cd\u65b0\u529f\u80fd\uff08\u5b9e\u73b0\uff09\u3002</li> </ol> <p>\u4e2d\u671f\uff08\u7b2c11\u5468\uff09\u5b8c\u6210\uff1a\u7efc\u8ff0  </p> <p>\u671f\u672b\uff08\u7b2c16\u5468\uff09\u5b8c\u6210\uff1a\u5b9e\u73b0</p> <p>\u53c2\u8003\u6587\u6863\uff1a</p> <ol> <li>What is eBPF\uff1f</li> <li>BPF and XDP Reference Guide</li> <li>Warping Reality - creating and countering the next generation of Linux rootkits using eBPF</li> <li>With Friends Like eBPF, Who Needs Enemies?</li> <li>\u5185\u6838\u6001eBPF\u7a0b\u5e8f\u5b9e\u73b0\u5bb9\u5668\u9003\u9038\u4e0e\u9690\u85cf\u8d26\u53f7rootkit</li> </ol>"},{"location":"proj/#12-ebpfverify","title":"1.2 eBPF\u7684Verify\u6a21\u5757\u7684\u6f0f\u6d1e\u53d1\u73b0\u4e0e\u5229\u7528","text":"<p>\u80cc\u666f\uff1a\u540c\u4e0a</p> <p>\u63cf\u8ff0\uff1a eBPF Verifier\u662fLinux\u5185\u6838\u5b89\u5168\u7684\u5173\u952e\u7ec4\u4ef6\uff0c\u7a0b\u5e8f\u5728\u52a0\u8f7d\u4e4b\u524d\u5fc5\u987b\u7ecf\u8fc7Verifier\u9a8c\u8bc1\uff0cVerifier\u4f1a\u68c0\u67e5\u6bcf\u4e2a\u53ef\u80fd\u6267\u884c\u7684\u7a0b\u5e8f\u6307\u4ee4\u5e8f\u5217\uff0c\u5728\u786e\u4fdd\u6ee1\u8db3\u6240\u6709eBPF\u5b89\u5168\u5047\u8bbe\u540e\u65b9\u53ef\u6267\u884c\u3002\u867d\u7136\u9a8c\u8bc1\u5668\u7684\u4ee3\u7801\u5df2\u7ecf\u7ecf\u8fc7\u4e86\u5c42\u5c42\u5ba1\u67e5\uff0c\u4f46\u968f\u7740 eBPF \u4e2d\u4e0d\u65ad\u6dfb\u52a0\u65b0\u529f\u80fd\u4ee5\u53caVerifier\u81ea\u8eab\u529f\u80fd\u7684\u590d\u6742\u6027\uff0c\u5176\u4e2d\u96be\u514d\u5b58\u5728\u6f0f\u6d1e\uff0c\u4e00\u65e6\u88ab\u6076\u610f\u5229\u7528\uff0c\u6781\u53ef\u80fd\u5f15\u53d1\u4e25\u91cd\u540e\u679c\u3002</p> <p>\u91cc\u7a0b\u7891\uff1a</p> <ol> <li>\u4e86\u89e3Verifier\u7684\u529f\u80fd\u548c\u5b9e\u73b0\u65b9\u5f0f\uff0c\u89e3\u91caVerifier\u7684\u590d\u6742\u6027\u4ee5\u53ca\u5176\u4e2d\u53ef\u80fd\u5b58\u5728\u7684\u6f0f\u6d1e\uff08\u7efc\u8ff0\uff09\u3002</li> <li>\u5b9e\u6218\u5229\u75282~3\u4e2aVerifier\u6f0f\u6d1e\uff0c\u5b9e\u73b0\u7cfb\u7edf\u63d0\u6743\u3001\u5bb9\u5668\u9003\u9038\u3001\u7cfb\u7edf\u5954\u6e83\u7b49\u4efb\u610f\u4e24\u4e2a\u653b\u51fb\uff08\u5b9e\u73b0\uff09\u3002</li> <li>\uff08\u9009\u505a\uff09\u5bf9\u5df2\u6709eBPF\u7684\u81ea\u52a8\u5316\u6f0f\u6d1e\u53d1\u73b0\u7a0b\u5e8f\u7684\u590d\u73b0\u548c\u6539\u8fdb\uff0c\u5c1d\u8bd5\u53d1\u73b0\u65b0\u7684\u6f0f\u6d1e\u3002</li> </ol> <p>\u4e2d\u671f\uff08\u7b2c11\u5468\uff09\u5b8c\u6210\uff1a\u7efc\u8ff0  </p> <p>\u671f\u672b\uff08\u7b2c16\u5468\uff09\u5b8c\u6210\uff1a\u5b9e\u73b0</p> <p>\u53c2\u8003\u6587\u6863\uff1a</p> <ol> <li>What is eBPF\uff1f</li> <li>BPF and XDP Reference Guide</li> <li>Warping Reality - creating and countering the next generation of Linux rootkits using eBPF</li> <li>Hao Sun, Yiru Xu, Jianzhong Liu, Yuheng Shen, Nan Guan, and Yu Jiang. 2024. Finding Correctness Bugs in eBPF Verifier with Structured and Sanitized Program. </li> <li>Chaoyuan Peng, Muhui Jiang, Lei Wu, and Yajin Zhou. 2024. Toss a Fault to BpfChecker: Revealing Implementation Flaws for eBPF runtimes with Differential Fuzzing. </li> </ol>"},{"location":"proj/#2","title":"2.\u57fa\u4e8e\u4eba\u5de5\u667a\u80fd\u7684\u4ee3\u7801\u6f0f\u6d1e\u68c0\u6d4b","text":"<p>\u80cc\u666f\uff1a \u4eba\u5de5\u5f00\u5c55\u4ee3\u7801\u6f0f\u6d1e\u6316\u6398\u8d39\u65f6\u8d39\u529b\uff0c\u4f20\u7edf\u9759\u6001\u6f0f\u6d1e\u68c0\u6d4b\u80fd\u591f\u5b9e\u73b0\u81ea\u52a8\u5316\u8bc6\u522b\u53ef\u7591\u6f0f\u6d1e\u70b9\uff0c\u4f46\u8bef\u62a5\u7387\u8f83\u9ad8\u4e14\u96be\u4ee5\u68c0\u6d4b\u590d\u6742\u7684\u4e0a\u4e0b\u6587\u6f0f\u6d1e\u3002\u57fa\u4e8e\u4eba\u5de5\u667a\u80fd\u7684\u6f0f\u6d1e\u4ee3\u7801\u68c0\u6d4b\u5b9a\u4f4d\u5177\u6709\u7406\u89e3\u4ee3\u7801\u4e0a\u4e0b\u6587\u76f8\u5173\u6027\u5e76\u5bf9\u7279\u5f81\u8fdb\u884c\u591a\u5c42\u6982\u62ec\u548c\u62bd\u8c61\u7684\u80fd\u529b\uff0c\u901a\u8fc7\u6a21\u578b\u7684\u81ea\u8eab\u6cdb\u5316\u80fd\u529b\u81ea\u52a8\u68c0\u6d4b\u4ee3\u7801\u4e2d\u76f8\u4f3c\u7684\u6f0f\u6d1e\uff0c\u53ef\u4ee3\u66ff\u4eba\u5de5\u5f00\u5c55\u7591\u4f3c\u6f0f\u6d1e\u786e\u8ba4\uff0c\u6709\u6548\u63d0\u9ad8\u68c0\u6d4b\u6548\u7387\u3002</p> <p>\u63cf\u8ff0\uff1a \u672c\u9879\u76ee\u65e8\u5728\u4f7f\u540c\u5b66\u4eec\u4e86\u89e3\u6f0f\u6d1e\u6316\u6398\u7684\u57fa\u672c\u77e5\u8bc6\uff0c\u5b66\u4e60\u8bad\u7ec3\u591a\u79cd\u795e\u7ecf\u7f51\u7edc\u6a21\u578b\u8fdb\u884c\u6f0f\u6d1e\u68c0\u6d4b\u4efb\u52a1\u3002\u66f4\u8fdb\u4e00\u6b65\u5c1d\u8bd5\u901a\u8fc7\u591a\u79cd\u6a21\u578b\u4f18\u5316\u7b56\u7565\u63d0\u5347\u6a21\u578b\u5b9a\u4f4d\u6f0f\u6d1e\u7684\u6548\u679c\uff0c\u6bd4\u5982\u8fdb\u884c\u66f4\u7ec6\u7c92\u5ea6\u7684\u7a0b\u5e8f\u5207\u7247\u3001\u4f7f\u7528\u5305\u542b\u66f4\u591a\u8bed\u4e49\u4fe1\u606f\u7684\u4ee3\u7801\u6807\u8bc6\u65b9\u6cd5\u3001\u63d0\u9ad8\u6a21\u578b\u8bc6\u522b\u6f0f\u6d1e\u6839\u56e0\u4f4d\u7f6e\u7684\u80fd\u529b\u7b49\u3002</p> <p>\u91cc\u7a0b\u7891\uff1a</p> <ol> <li>\u7406\u89e3\u795e\u7ecf\u7f51\u7edc\u6a21\u578b\u68c0\u6d4b\u6e90\u4ee3\u7801\u6f0f\u6d1e\u7684\u6280\u672f\u539f\u7406\uff0c\u8c03\u7814\u4e09\u7bc7\u73b0\u6709\u6e90\u4ee3\u7801\u6f0f\u6d1e\u68c0\u6d4b\u5de5\u4f5c\uff0c\u7efc\u8ff0\u5176\u6838\u5fc3\u65b9\u6cd5\u53ca\u5de5\u4f5c</li> <li>\u5b9e\u73b0\u5df2\u6709\u6e90\u4ee3\u7801\u6f0f\u6d1e\u68c0\u6d4b\u6a21\u578b\uff0c\u5728\u6d4b\u8bd5\u96c6\u4e0a\u63d0\u5347\u51c6\u786e\u5ea6</li> </ol> <p>\u4e2d\u671f\uff08\u7b2c11\u5468\uff09\u5b8c\u6210: \u7efc\u8ff0</p> <p>\u671f\u672b\uff08\u7b2c16\u5468\uff09\u5b8c\u6210: \u5b9e\u73b0</p> <p>\u53c2\u8003\u6587\u6863\uff1a</p> <ol> <li>VulChecker: Graph-based Vulnerability Localization in Source Code https://github.com/ymirsky/VulChecker</li> <li>Devign: Effective vulnerability identification by learning comprehensive program semantics via graph neural networks</li> <li>GPTScan: Detecting Logic Vulnerabilities in Smart Contracts by Combining GPT with Program Analysis https://mp.weixin.qq.com/s/kZfsa7oi_e9rTTjSQR7mXg</li> <li>Codebert: A pre-trained model for programming and natural languages[J]. arXiv preprint arXiv:2002.08155, 2020.</li> <li>Contrabert: Enhancing code pre-trained models via contrastive learning[C]//2023 IEEE/ACM 45th International Conference on Software Engineering </li> </ol>"},{"location":"proj/#3android","title":"3.Android\u5e94\u7528\u6297\u52a0\u56fa\u5206\u6790","text":"<p>\u80cc\u666f\uff1a \u968f\u7740Android\u5e94\u7528\u7684\u5e7f\u6cdb\u4f7f\u7528\uff0c\u5f00\u53d1\u8005\u4e3a\u4e86\u4fdd\u62a4\u5176\u5e94\u7528\u7684\u77e5\u8bc6\u4ea7\u6743\u548c\u9632\u6b62\u88ab\u5206\u6790\uff0c\u901a\u5e38\u4f1a\u91c7\u7528\u52a0\u56fa\u6280\u672f\uff0c\u4f8b\u5982\u52a0\u58f3\u3001\u4ee3\u7801\u6df7\u6dc6\u3001\u73af\u5883\u68c0\u6d4b\u7b49\u6280\u672f\u3002\u8fd9\u4e9b\u6280\u672f\u4f7f\u5f97\u5e94\u7528\u7684\u9006\u5411\u5de5\u7a0b\u548c\u52a8\u6001\u5206\u6790\u53d8\u5f97\u56f0\u96be\uff0c\u4ece\u800c\u589e\u52a0\u4e86\u5b89\u5168\u5206\u6790\u7684\u590d\u6742\u6027\u3002\u7136\u800c\uff0c\u8fd9\u4e9b\u6280\u672f\u4e5f\u53ef\u80fd\u88ab\u6076\u610f\u5e94\u7528\u5229\u7528\uff0c\u4ee5\u9003\u907f\u5b89\u5168\u68c0\u6d4b\u3002\u56e0\u6b64\uff0c\u7814\u7a76\u5982\u4f55\u68c0\u6d4b\u548c\u5bf9\u6297\u8fd9\u4e9b\u6297\u5206\u6790\u6280\u672f\u5bf9\u4e8e\u63d0\u5347Android\u5e94\u7528\u7684\u5b89\u5168\u6027\u81f3\u5173\u91cd\u8981\u3002</p> <p>\u63cf\u8ff0\uff1a \u672c\u9879\u76ee\u65e8\u5728\u4f7f\u540c\u5b66\u4eec\u4e86\u89e3Android\u5e94\u7528\u5206\u6790\u6280\u672f\uff0c\u6df1\u5165\u63a2\u7a76Android\u5e94\u7528\u5206\u6790\u4e2d\u7684\u6297\u52a0\u56fa\u6280\u672f\u3002</p> <p>\u91cc\u7a0b\u7891\uff1a</p> <ol> <li>\u4e86\u89e3\u5e38\u89c1\u7684\u4ee3\u7801\u6df7\u6dc6\u3001\u52a0\u58f3\u3001\u73af\u5883\u68c0\u6d4b\u7b49\u6280\u672f\u53ca\u5176\u5b9e\u73b0\u539f\u7406\uff1b</li> <li>\uff08\u4e8c\u9009\u4e00\uff09\u590d\u73b0\u4e00\u4e2a\u73b0\u6709\u7684\u53bb\u6df7\u6dc6\u3001\u8131\u58f3\u6216\u73af\u5883\u5bf9\u6297\u7684\u5de5\u4f5c\uff08\u590d\u73b0\uff09\uff1b</li> <li>\uff08\u4e8c\u9009\u4e00\uff09\u5b9e\u73b0\u4e00\u4e2a\u80fd\u591f\u68c0\u6d4bAndroid\u5e94\u7528\u4f7f\u7528\u4e86\u54ea\u4e9b\u52a0\u56fa\u6280\u672f\u7684\u5de5\u5177\uff08\u5b9e\u73b0\uff09\u3002</li> </ol> <p>\u4e2d\u671f\uff08\u7b2c11\u5468\uff09\u5b8c\u6210 \uff1a1</p> <p>\u671f\u672b \uff08\u7b2c16\u5468\uff09 \u5b8c\u6210\uff1a2\u62163</p> <p>\u53c2\u8003\u6587\u6863\uff1a</p> <ol> <li>Xue, L.; Zhou, H.; Luo, X.; Zhou, Y.; Shi, Y.; Gu, G.; Zhang, F.; Au, M. H. Happer: Unpacking Android Apps via a Hardware-Assisted Approach. In 2021 IEEE Symposium on Security and Privacy (SP); IEEE: San Francisco, CA, USA, 2021; pp 1641\u20131658. https://doi.org/10.1109/SP40001.2021.00105.</li> <li>Xue, L.; Zhou, H.; Luo, X.; Yu, L.; Wu, D.; Zhou, Y.; Ma, X. PackerGrind: An Adaptive Unpacking System for Android Apps. IIEEE Trans. Software Eng.2022, 48 (2), 551\u2013570. https://doi.org/10.1109/TSE.2020.2996433.</li> <li>Kondracki, B.; Azad, B. A.; Miramirkhani, N.; Nikiforakis, N. The Droid Is in the Details: Environment-Aware Evasion of Android Sandboxes. In Proceedings 2022 Network and Distributed System Security Symposium; Internet Society: San Diego, CA, USA, 2022. https://doi.org/10.14722/ndss.2022.23056.</li> <li>Gao, C.; Cai, M.; Yin, S.; Huang, G.; Li, H.; Yuan, W.; Luo, X. Obfuscation-Resilient Android Malware Analysis Based on Complementary Features. IEEE Trans.Inform.Forensic Secur. 2023, 18, 5056\u20135068. https://doi.org/10.1109/TIFS.2023.3302509.</li> </ol>"},{"location":"proj/#4rustc","title":"4.Rust/C\u8de8\u8bed\u8a00\u8c03\u7528\u5206\u6790","text":"<p>\u80cc\u666f\uff1aRust\u901a\u5e38\u7528\u4e8e\u6bd4\u8f83\u5e95\u5c42\u7684\u9879\u76ee\uff0c\u4e0eC\u7684\u8bed\u8a00\u89c4\u8303\u76f8\u8fd1\uff0c\u56e0\u6b64\u5f00\u53d1\u8005\u4e3a\u907f\u514d\u91cd\u5199\u4ee3\u7801\u4f1a\u91cd\u7528C\u4ee3\u7801\uff0c\u56e0\u6b64\u4f1a\u4f7f\u7528\u8de8\u8bed\u8a00\u8c03\u7528\u673a\u5236\u3002\u5982\u679cC\u8bed\u8a00\u90e8\u5206\u5b58\u5728\u95ee\u9898\uff0c\u6216\u8005\u8de8\u8bed\u8a00\u63a5\u53e3\u62bd\u8c61\u5b58\u5728\u95ee\u9898\uff0c\u90fd\u662f\u96be\u4ee5\u4fee\u590d\u6216\u8005\u6ede\u540e\u4fee\u590d\u7684\u3002</p> <p>\u63cf\u8ff0\uff1a\u56e0\u6b64\u6211\u4eec\u9700\u8981\u5206\u6790Rust\u751f\u6001\u4e2d\u7684library\u4ee5\u53ca\u9762\u5411\u7528\u6237\u7684Rust\u5e94\u7528\u4f7f\u7528\u8de8\u8bed\u8a00\u8c03\u7528\u7684\u60c5\u51b5\uff0c\u627e\u5230\u771f\u5b9e\u7684CVE\uff0c\u540c\u65f6\u8bbe\u8ba1PoC\u5bf9CVE\u8fdb\u884c\u5229\u7528\uff0c\u5e76\u7ed9\u51fa\u9632\u62a4\u601d\u8def\u3002</p> <p>\u91cc\u7a0b\u7891\uff1a</p> <p>\u4e2d\u671f\uff08\u7b2c11\u5468\uff09\u5b8c\u6210\uff1a\u7efc\u8ff0\u3001PoC\u5b9e\u73b0  </p> <p>\u671f\u672b\uff08\u7b2c16\u5468\uff09\u5b8c\u6210\uff1a\u591a\u4e2aPoC\uff0c\u9632\u62a4\u601d\u8def</p> <p>\u53c2\u8003\u6587\u6863\uff1a </p> <ol> <li>Cross-Language Attacks, NDSS 22</li> </ol>"},{"location":"proj/#5mcu-rehosting","title":"5.\u652f\u6301\u591a\u79cd\u5904\u7406\u5668\u67b6\u6784\u7684MCU Rehosting\u6846\u67b6","text":"<p>\u80cc\u666f\uff1a \u5927\u591a\u6570rehosting\u6846\u67b6\u53ea\u652f\u6301ARM\u6216x86\u7b49\u5e38\u89c1\u67b6\u6784\uff0c\u4f46\u5728\u4e00\u4e9b\u7279\u5b9a\u573a\u666f\u4e0b\uff0c\u6709\u8bb8\u591a\u975e\u5e38\u89c4\u67b6\u6784\u7684\u56fa\u4ef6\u3002\u4f8b\u5982\u667a\u80fd\u4e92\u8054\u7f51\u6c7d\u8f66\u7684\u573a\u666f\u4e2d\uff0c\u6709C166\uff0cRH850\uff0cV850\uff0cSH-2A\u7b49\u6c7d\u8f66\u56fa\u4ef6\u4e2d\u7684\u7279\u5b9a\u67b6\u6784\u3002\u5982\u4f55\u9488\u5bf9\u8fd9\u4e9b\u67b6\u6784\u7684MCU\u8fdb\u884crehosting\u5177\u6709\u6311\u6218\u6027\uff0c\u4e5f\u540c\u65f6\u662f\u4e00\u9879\u7814\u7a76\u91cd\u70b9\u3002\u63cf\u8ff0:\u672c\u9879\u76ee\u65e8\u5728\u4f7f\u540c\u5b66\u4eec\u6df1\u5165\u7406\u89e3\u4e0d\u540c\u67b6\u6784\u7684MCU\u5982\u4f55rehosting\uff0c\u5b66\u4e60\u548c\u4e86\u89e3architecture-agnostic\u7684MCU rehosting\u7684\u6846\u67b6\uff0c\u5e76\u5728\u6b64\u57fa\u7840\u4e0a\u5bf9\u56fa\u4ef6\u8fdb\u884c\u52a8\u6001\u5206\u6790\uff0c\u4f8b\u5982fuzzing\u3002</p> <p>\u63cf\u8ff0\uff1a</p> <ol> <li>Chen Z\u7b49\u4eba\u901a\u8fc7\u6784\u5efa\u65b0\u7684rehosting\u6846\u67b6\uff0c\u7a81\u7834\u4e86\u4f20\u7edf\u6a21\u62df\u5668\uff08\u5982QEMU\uff09\u4e0d\u652f\u6301\u975e\u4e3b\u6d41\u82af\u7247\u67b6\u6784\u7684\u9650\u5236\uff0c\u5b9e\u73b0\u4e86\u5bf9\u76f8\u5173\u56fa\u4ef6\u7684\u52a8\u6001\u5206\u6790\u548c\u6d4b\u8bd5\u3002\u4e8e\u9896\u8d85\u7b49\u4eba\u5bf9\u5d4c\u5165\u5f0f\u8bbe\u5907\u56fa\u4ef6\u7684\u5b89\u5168\u5206\u6790\u6280\u672f\u548c\u76f8\u5173\u5de5\u4f5c\u8fdb\u884c\u4e86\u7cfb\u7edf\u6027\u7684\u5206\u7c7b\u548c\u4ecb\u7ecd\u3002\u8bf7\u9605\u8bfb\u76f8\u5173\u8bba\u6587\uff0c\u641c\u7d22\u66f4\u591a\u76f8\u5173\u6587\u732e\uff0c\u5e76\u64b0\u5199\u4e00\u7bc7\u5173\u4e8eMCU rehosting\u7684\u7b80\u5355\u4f46\u8981\u70b9\u9f50\u5168\u7684\u7efc\u8ff0\u3002</li> <li>Feng B\u7b49\u4eba\u901a\u8fc7\u5916\u8bbe-\u63a5\u53e3\u5efa\u6a21\u6280\u672f\uff0c\u6446\u8131\u4e86MCU\u56fa\u4ef6\u8fd0\u884c\u9700\u8981\u4f9d\u8d56\u591a\u4e2a\u786c\u4ef6\u5916\u8bbe\u7684\u9650\u5236\u6761\u4ef6\uff0c\u5b9e\u73b0\u4e86MCU\u56fa\u4ef6\u7684rehosting\u548c\u52a8\u6001\u5206\u6790\uff0c\u5e76\u53d1\u73b0\u591a\u4e2a\u6f0f\u6d1e\u3002\u8bf7\u9605\u8bfb\u76f8\u5173\u8bba\u6587\u5e76\u8fdb\u884c\u590d\u73b0\uff0c\u5e76\u53d1\u73b0\u81f3\u5c11\u4e00\u4e2acrash\u3002</li> <li>\u5b9e\u73b0\u5bf9\u9644\u4ef6\u56fa\u4ef6goodwatch.elf(MCU msp430)\u7684rehosting\uff0c\u5e76\u8bb0\u5f55\u8fd0\u884c\u65e5\u5fd7\u3002\uff08\u8be5\u56fa\u4ef6\u7531\u52a9\u6559\u63d0\u4f9b\uff09</li> <li>\uff08\u9644\u52a0\uff09\u5bf9\u9644\u4ef6\u56fa\u4ef6\u8fdb\u884c\u52a8\u6001\u8c03\u8bd5\u6216\u6a21\u7cca\u6d4b\u8bd5\uff0c\u5e76\u5c1d\u8bd5\u8fdb\u884c\u6f0f\u6d1e\u6316\u6398\u3002</li> </ol> <p>\u91cc\u7a0b\u7891\uff1a</p> <p>\u4e2d\u671f\uff08\u7b2c11\u5468\uff09\u5b8c\u62101</p> <p>\u671f\u672b\uff08\u7b2c16\u5468\uff09\u5b8c\u62102\u30013</p> <p>\u53c2\u8003\u6587\u6863\uff1a</p> <ol> <li>Feng B, Mera A, Lu L. {P2IM}: Scalable and hardware-independent firmware testing via automatic peripheral interface modeling[C]//29th USENIX Security Symposium (USENIX Security 20). 2020: 1237-1254.</li> <li>Chen Z, Thomas S L, Garcia F D. Metaemu: An architecture agnostic rehosting framework for automotive firmware[C]//Proceedings of the 2022 ACM SIGSAC Conference on Computer and Communications Security. 2022: 515-529.</li> <li>\u4e8e\u9896\u8d85, \u9648\u5de6\u5b81, \u7518\u6c34\u6ed4, \u7b49. \u5d4c\u5165\u5f0f\u8bbe\u5907\u56fa\u4ef6\u5b89\u5168\u5206\u6790\u6280\u672f\u7814\u7a76[J]. \u8ba1\u7b97\u673a\u5b66\u62a5, 2021.</li> </ol>"},{"location":"proj/#6","title":"6.\u57fa\u4e8e\u5927\u6a21\u578b\u751f\u6210\u4ee3\u7801\u7684\u8bc4\u4f30\u6307\u6807\u8bbe\u8ba1\u548c\u6d4b\u8bd5","text":"<p>\u80cc\u666f\uff1a \u5927\u8bed\u8a00\u6a21\u578b\uff08LLMs\uff09\u5728\u4ee3\u7801\u751f\u6210\u9886\u57df\u5df2\u53d6\u5f97\u663e\u8457\u8fdb\u5c55\uff0c\u6d8c\u73b0\u51fa\u5927\u91cf\uff08\u4ee3\u7801\uff09\u5927\u6a21\u578b\uff08\u5982Qwen-Coder\u3001DeepSeek-Coder\u3001CodeLlama\u3001Qwen\uff09\u3002\u8fd9\u4e9b\u6a21\u578b\u5728\u4ee3\u7801\u8d28\u91cf\u3001\u6267\u884c\u6548\u7387\u53ca\u591a\u8bed\u8a00\u652f\u6301\u7b49\u65b9\u9762\u5dee\u5f02\u663e\u8457\u3002\u867d\u7136\u73b0\u6709\u70ed\u95e8\u4ee3\u7801\u751f\u6210\u8bc4\u4f30\u4f53\u7cfb\uff08\u5982LiveCodeBench\u3001HumanEval\u3001MBPP\uff09\u5df2\u63d0\u51fa\u591a\u7ef4\u8bc4\u4f30\u6307\u6807\uff0c\u4f46\u4ed6\u4eec\u5927\u591a\u4ec5\u5173\u6ce8\u6b63\u786e\u6027\uff0c\u5374\u5ffd\u7565\u4e86\u8bf8\u5982\u5b89\u5168\u6027\u3001\u9c81\u68d2\u6027\u3001\u53ef\u9760\u6027\u3001\u6027\u80fd\u3001\u7248\u6743\u4e0e\u5408\u89c4\u6027\u7b49\u5176\u4ed6\u5173\u952e\u56e0\u7d20\uff0c\u6bd5\u7adf\u53ef\u6267\u884c\u4ee3\u7801\u5e76\u4e0d\u7b49\u540c\u4e8e\u53ef\u9760\u548c\u5065\u58ee\u7684\u4ee3\u7801\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u9996\u5148\u9700\u8981\u8c03\u7814\u73b0\u6709\u7684\u70ed\u95e8\u5927\u6a21\u578b\u751f\u6210\u4ee3\u7801\u8bc4\u4f30\u6307\u6807\uff0c\u7136\u540e\u603b\u7ed3\u6279\u5224\u5e76\u63d0\u51fa\u503c\u5f97\u6539\u8fdb\u7684\u5730\u65b9\u3002\u6bd4\u5982\u6709\u4eba\u63d0\u51fa\u8bc4\u4f30\u5927\u6a21\u578b\u6ee5\u7528API\u7a0b\u5ea6\u7684\u65b9\u6cd5\uff1b\u4e5f\u6709\u4eba\u63d0\u51fa\u8bc4\u6d4b\u4ee3\u7801\u5927\u6a21\u578b\u6548\u7387\u7684\u65b9\u6cd5\u3002</p> <p>\u63cf\u8ff0\uff1a \u672c\u9879\u76ee\u901a\u8fc7\u7cfb\u7edf\u6027\u8c03\u7814\u4e0e\u5b9e\u8df5\uff0c\u63a2\u7d22\u5927\u6a21\u578b\u4ee3\u7801\u8bc4\u4f30\u7684\u521b\u65b0\u65b9\u6cd5\uff0c\u6db5\u76d6\u4e86\u5927\u6a21\u578b\u7684\u63a8\u7406\u8fd0\u884c\u3001\u8bc4\u4f30\u6807\u51c6\u521b\u65b0\u8bbe\u8ba1\u8fd0\u884c\u3001\u6d4b\u8bd5\u6837\u4f8b\u8bbe\u8ba1\u7b49\u591a\u4e2a\u5173\u952e\u73af\u8282\u3002</p> <p>\u91cc\u7a0b\u7891\uff1a</p> <ol> <li>\u603b\u7ed3\u548c\u6279\u5224\u73b0\u6709\u70ed\u95e8\u5927\u6a21\u578b\u751f\u6210\u4ee3\u7801\u8bc4\u4f30\u6307\u6807\uff0c\u4e0d\u4f4e\u4e8e5\u79cd\uff08\u7efc\u8ff0\uff09\u3002</li> <li>\u81ea\u884c\u8bbe\u8ba1\u4e0d\u540c\u4e8e\u70ed\u95e8\u8bc4\u4f30\u6307\u6807\u7684\u521b\u65b0\u6307\u6807\u5e76\u8fd0\u884c\u8fd9\u4e2a\u6307\u6807\u3002\u8bbe\u8ba1\u65b9\u9762\u8981\u6c42\u5728\u4e0a\u8ff0\u5176\u4ed6\u5173\u952e\u56e0\u7d20\u4e2d\u7684\u4e00\u4e2a\u65b9\u9762\u521b\u65b0\u3002\u53ef\u53c2\u8003\u5f00\u6e90\u4ee3\u7801\uff0c\u4f46\u4e0d\u53ef\u6284\u88ad\u3002\u6d4b\u8bd5\u96c6\u548c\u6d4b\u8bd5\u6837\u4f8b\uff08\u5982\u9700\uff09\u5747\u9700\u81ea\u884c\u8bbe\u8ba1\uff0c\u6570\u91cf5~10\u4e2a\u5373\u53ef\u3002\u88ab\u6d4b\u8bd5\u7684\u5927\u6a21\u578b\u6570\u91cf\u4e0d\u5f97\u4f4e\u4e8e1\u4e2a\uff08\u5b9e\u73b0\uff09\u3002</li> </ol> <p>\u4e2d\u671f\uff08\u7b2c11\u5468\uff09\u5b8c\u6210\uff1a\u7efc\u8ff0</p> <p>\u671f\u672b\uff08\u7b2c16\u5468\uff09\u5b8c\u6210\uff1a\u5b9e\u73b0</p> <p>\u53c2\u8003\u6587\u6863\uff1a</p> <ol> <li>DeepSeek-AI, Daya Guo, Dejian Yang, Haowei Zhang, Junxiao Song, Ruoyu Zhang, Runxin Xu, et al. 2025. \u201cDeepSeek-R1: Incentivizing Reasoning Capability in LLMs via Reinforcement Learning.\u201d </li> <li>DeepSeek-AI, Aixin Liu, Bei Feng, Bing Xue, Bingxuan Wang, Bochao Wu, Chengda Lu, et al. 2024. \u201cDeepSeek-V3 Technical Report.\u201d </li> <li>DeepSeek-AI, Qihao Zhu, Daya Guo, Zhihong Shao, Dejian Yang, Peiyi Wang, Runxin Xu, et al. 2024. \u201cDeepSeek-Coder-V2: Breaking the Barrier of Closed-Source Models in Code Intelligence.\u201d </li> <li>Hui, Binyuan, Jian Yang, Zeyu Cui, Jiaxi Yang, Dayiheng Liu, Lei Zhang, Tianyu Liu, et al. 2024. \u201cQwen2.5-Coder Technical Report.\u201d </li> <li>Rozi\u00e8re, Baptiste, Jonas Gehring, Fabian Gloeckle, Sten Sootla, Itai Gat, Xiaoqing Ellen Tan, Yossi Adi, et al. 2024. \u201cCode Llama: Open Foundation Models for Code.\u201d</li> <li>Austin, Jacob, Augustus Odena, Maxwell Nye, Maarten Bosma, Henryk Michalewski, David Dohan, Ellen Jiang, et al. 2021. \u201cProgram Synthesis with Large Language Models.\u201d</li> <li>Chen, Mark, Jerry Tworek, Heewoo Jun, Qiming Yuan, Henrique Ponde de Oliveira Pinto, Jared Kaplan, Harri Edwards, et al. 2021. \u201cEvaluating Large Language Models Trained on Code.\u201d</li> <li>Jain, Naman, King Han, Alex Gu, Wen-Ding Li, Fanjia Yan, Tianjun Zhang, Sida Wang, Armando Solar-Lezama, Koushik Sen, and Ion Stoica. 2024. \u201cLiveCodeBench: Holistic and Contamination Free Evaluation of Large Language Models for Code.\u201d</li> <li>Du, Mingzhe, Anh Tuan Luu, Bin Ji, Qian Liu, and See{-}Kiong Ng. 2024. \u201cMercury: {A} Code Efficiency Benchmark for Code Large Language Models.\u201d In Proceedings of the Advances in Neural Information Processing Systems 38: Annual Conference on Neural Information Processing Systems 2024, 37:16601\u201322.</li> <li>Zhong, Li, and Zilong Wang. 2024. \u201cCan LLM Replace Stack Overflow? A Study on Robustness and Reliability of Large Language Model Code Generation.\u201d Proceedings of the AAAI Conference on Artificial Intelligence 38 (19): 21841\u201349.</li> </ol>"},{"location":"proj/#7mte","title":"7.\u57fa\u4e8eMTE\u7684\u5185\u5b58\u5b8c\u6574\u6027\u4fdd\u62a4","text":"<p>\u80cc\u666f\uff1a \u5185\u5b58\u635f\u574f\u6f0f\u6d1e\u4ecd\u7136\u662f\u6700\u5e38\u89c1\u4e14\u540e\u679c\u6700\u4e25\u91cd\u7684\u6f0f\u6d1e\u4e4b\u4e00\uff0c\u5b83\u65e2\u5305\u62ec\u6808\u6ea2\u51fa\u3001\u5806\u6ea2\u51fa\u7b49\u7a7a\u95f4\u7ef4\u5ea6\u4e0a\u7684\u6f0f\u6d1e\uff0c\u4e5f\u5305\u62ec\u91cd\u590d\u91ca\u653e\uff08Double-free\uff09\u548c\u91ca\u653e\u540e\u4f7f\u7528\uff08Use-after-free\uff09\u7b49\u65f6\u95f4\u7ef4\u5ea6\u4e0a\u7684\u6f0f\u6d1e\u3002\u786c\u4ef6\u5382\u5546\u63d0\u51fa\u4e86\u4e0d\u540c\u79cd\u7c7b\u7684\u786c\u4ef6\u652f\u6301\u6765\u9ad8\u6548\u5730\u7f13\u89e3\u5185\u5b58\u635f\u574f\u6f0f\u6d1e\uff0c\u800cMemory Tagging Extension\uff08MTE\uff09\u5c31\u662f\u5176\u4e2d\u4e4b\u4e00\u3002</p> <p>Arm\u57282019\u5e74\u53d1\u5e03\u7684ARMv8.5\u786c\u4ef6\u89c4\u8303\u4e2d\u9996\u6b21\u63d0\u51fa\u4e86MTE\uff0c\u5b83\u75284\u4e2a\u6bd4\u7279\u4f4d\u5bf9\u6bcf16\u5b57\u8282\u7684\u5185\u5b58\u8fdb\u884c\u7740\u8272\uff0c\u800c\u6307\u9488\u7684\u9ad8\u4f4d\u540c\u6837\u67094\u4e2a\u6bd4\u7279\u4f4d\u6807\u8bb0\u6307\u9488\u7684\u989c\u8272\u3002\u5982\u6b64\uff0c\u53ea\u6709\u5f53\u6307\u9488\u989c\u8272\u548c\u5185\u5b58\u989c\u8272\u4e00\u81f4\u65f6\u8bbf\u5b58\u64cd\u4f5c\u624d\u662f\u5408\u6cd5\u7684\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0cMTE\u540c\u65f6\u80fd\u9632\u62a4\u65f6\u7a7a\u4e24\u4e2a\u7ef4\u5ea6\u4e0a\u7684\u5185\u5b58\u635f\u574f\u6f0f\u6d1e\uff0c\u56e0\u6b64\u8fd1\u5e74\u6765\u53d7\u5230\u5de5\u4e1a\u754c\u548c\u5b66\u672f\u754c\u7684\u5e7f\u6cdb\u5173\u6ce8\u3002\u7136\u800c\uff0c\u76ee\u524d\u8fd8\u7f3a\u4e4f\u53ef\u884c\u7684\u57fa\u4e8eMTE\u7684\u5bf9\u5185\u6838\u5185\u5b58\u8fdb\u884c\u5b9e\u65f6\u4fdd\u62a4\u7684\u65b9\u6cd5\uff0c\u7531\u4e8e\u5185\u6838\u5b89\u5168\u7684\u91cd\u8981\u6027\u548cMTE\u786c\u4ef6\u63d0\u4f9b\u7684\u9ad8\u6027\u80fd\u5b89\u5168\u80fd\u529b\uff0c\u5982\u4f55\u5c06\u4e8c\u8005\u6709\u673a\u7ed3\u5408\u5df2\u7ecf\u6210\u4e3a\u8fd1\u5e74\u6765\u7814\u7a76\u7684\u5173\u6ce8\u7126\u70b9\u3002</p> <p>\u63cf\u8ff0\uff1a \u672c\u9879\u76ee\u65e8\u5728\u4f7f\u540c\u5b66\u4eec\u5165\u95e8\u786c\u4ef6\u8f85\u52a9\u5b89\u5168\uff08Hardware-assisted security\uff09\u8fd9\u4e00\u70ed\u95e8\u9886\u57df\uff0c\u540c\u65f6\u6df1\u5165\u4e86\u89e3MTE\u8fd9\u4e00\u65b0\u5174\u7684\u786c\u4ef6\u5b89\u5168\u7279\u6027\u3002</p> <p>\u91cc\u7a0b\u7891\uff1a</p> <ol> <li>\u9605\u8bfb\u53c2\u8003\u6587\u6863\u5e76\u6536\u96c6\u66f4\u591a\u7684\u76f8\u5173\u8d44\u6599\u548c\u6587\u732e\uff0c\u603b\u7ed3MTE\u7684\u4f18\u7f3a\u70b9 (\u7efc\u8ff0)</li> <li>\u6210\u529f\u7f16\u8bd1\u652f\u6301MTE\u7684Linux\u5185\u6838\u5e76\u5728QEMU\u4e0a\u8fd0\u884c\uff0c\u540c\u65f6\u8fd0\u884c\u4e00\u4e2a\u88ab\u4fdd\u62a4\u7684\u7a0b\u5e8f \uff08\u5b9e\u73b0\uff09\u3002</li> </ol> <p>\u4e2d\u671f\uff08\u7b2c11\u5468\uff09\u5b8c\u6210\uff1a\u7efc\u8ff0  </p> <p>\u671f\u672b\uff08\u7b2c16\u5468\uff09\u5b8c\u6210\uff1a\u5b9e\u73b0</p> <p>\u53c2\u8003\u6587\u6863\uff1a</p> <ol> <li>ARM MTE\u767d\u76ae\u4e66</li> <li>\u5185\u5b58\u95ee\u9898\u7684\u7ec8\u6781\u6b66\u5668\u2014\u2014MTE</li> <li>Memory Tagging and how it improves C/C++ memory safety</li> <li>Memory Tagging Extension (MTE) in AArch64 Linux</li> <li>Color My World: Deterministic Tagging for Memory Safety</li> </ol>"},{"location":"proj/#8-mali-gpupage-uaf","title":"8. Mali GPU\u4e2d\u7684Page UAF\u6f0f\u6d1e","text":"<p>\u80cc\u666f\uff1a Arm Mali GPU\u4f5c\u4e3a\u79fb\u52a8\u8bbe\u5907\u4e13\u7528\u56fe\u5f62\u5904\u7406\u5668\uff0c\u5e7f\u6cdb\u96c6\u6210\u4e8eAndroid\u667a\u80fd\u624b\u673a\u3001\u7269\u8054\u7f51\u8bbe\u5907\u53ca\u667a\u80fd\u7535\u89c6\u7b49\u7ec8\u7aef\u3002\u5728Android\u7cfb\u7edf\u4e2d\uff0cGPU\u9a71\u52a8\u7a0b\u5e8f\u901a\u8fc7\u7528\u6237-\u5185\u6838\u6001\u63a5\u53e3\u5411\u5e94\u7528\u5c42\u5f00\u653e\u8bbf\u95ee\u6743\u9650\uff0c\u8fd9\u4f7f\u5f97\u6f5c\u5728\u6076\u610f\u5e94\u7528\u53ef\u5bf9\u5185\u6838\u6001\u9a71\u52a8\u53d1\u8d77\u653b\u51fb\u3002\u636e\u7edf\u8ba1\uff0c\u5f53\u524dAndroid\u8bbe\u5907GPU\u4e3b\u8981\u91c7\u7528\u9ad8\u901aAdreno\u4e0eArm Mali\u4e24\u79cd\u67b6\u6784\uff0c\u8986\u76d6\u8d85\u8fc795%\u7684\u5e02\u573a\u4efd\u989d\u3002\u56e0\u6b64\uff0c\u9488\u5bf9\u8fd9\u4e24\u7c7bGPU\u9a71\u52a8\u7a0b\u5e8f\u7684\u6f0f\u6d1e\u7814\u7a76\u5177\u6709\u5e7f\u6cdb\u7684\u5b9e\u9645\u610f\u4e49\u3002 GPU\u9a71\u52a8\u6838\u5fc3\u529f\u80fd\u4e4b\u4e00\u662f\u5b9e\u73b0\u7528\u6237\u6001\u8fdb\u7a0b\u4e0eGPU\u786c\u4ef6\u95f4\u7684\u5171\u4eab\u5185\u5b58\u7ba1\u7406\u3002\u7531\u4e8e\u6d89\u53ca\u590d\u6742\u7684\u5185\u5b58\u5206\u914d\u3001\u6620\u5c04\u4e0e\u540c\u6b65\u673a\u5236\uff0c\u8be5\u6a21\u5757\u5e38\u6210\u4e3a\u5b89\u5168\u6f0f\u6d1e\u7684\u9ad8\u53d1\u533a\u57df\u3002\u6b64\u7c7b\u6f0f\u6d1e\u5f80\u5f80\u5bfc\u81f4\u5185\u5b58\u635f\u574f\u7c7b\u98ce\u9669\uff0c\u4e14\u73b0\u6709\u9632\u62a4\u673a\u5236\u96be\u4ee5\u6709\u6548\u68c0\u6d4b\u3002\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0cGoogle Project Zero 2021\u5e74\u5ea6\u62a5\u544a\u6307\u51fa\uff0c\u5f53\u5e74\u68c0\u6d4b\u5230\u7684Android\u7cfb\u7edf7\u4e2a0-day\u6f0f\u6d1e\u4e2d\uff0c5\u4e2a\u5747\u5b58\u5728\u4e8eGPU\u9a71\u52a8\u7a0b\u5e8f\u6a21\u5757\u3002</p> <p>\u63cf\u8ff0\uff1a \u5728\u524d\u671f\u8bfe\u7a0b\u548c\u5b9e\u9a8c\u4e2d\uff0c\u5927\u5bb6\u5df2\u638c\u63e1\u4e86UAF\uff08use-after-free\uff09\u6f0f\u6d1e\u57fa\u672c\u539f\u7406\u3001\u89e6\u53d1\u6761\u4ef6\u53ca\u5229\u7528\u65b9\u5f0f\u3002\u672c\u5b9e\u9a8c\u8981\u6c42\u540c\u5b66\u4eec\u5c06UAF\u6f0f\u6d1e\u7684\u7814\u7a76\u62d3\u5c55\u81f3GPU\u9a71\u52a8\u5b89\u5168\u9886\u57df\uff0cGPU\u9a71\u52a8\u56e0\u5176\u76f4\u63a5\u63a7\u5236\u786c\u4ef6\u8d44\u6e90\u7684\u7279\u6027\uff08\u5982\u7269\u7406\u9875\u8868\u7ba1\u7406\u3001\u5185\u5b58\u6620\u5c04\u7b49\uff09\uff0c\u6210\u4e3a\u653b\u51fb\u8005\u7a81\u7834\u7cfb\u7edf\u9694\u79bb\u673a\u5236\u7684\u91cd\u8981\u76ee\u6807\u3002\u901a\u8fc7\u64cd\u63a7GPU\u9a71\u52a8\u7684\u6f0f\u6d1e\uff0c\u653b\u51fb\u8005\u53ef\u80fd\u7ed5\u8fc7CPU\u4fa7\u7684\u5b89\u5168\u9632\u62a4\u3002</p> <p>\u91cc\u7a0b\u7891\uff1a</p> <ol> <li>\u901a\u8fc7\u516c\u5f00\u6f0f\u6d1e\u5e93\u3001\u5b66\u672f\u8bba\u6587\u7b49\u8d44\u6e90\uff0c\u81ea\u4e3b\u68c0\u7d22\u8fd1\u5e74\u516c\u5e03\u7684\u4e0eGPU\u9a71\u52a8\u76f8\u5173\u7684UAF\u6f0f\u6d1e\u6848\u4f8b\uff08\u5982\u5185\u5b58\u7ba1\u7406\u3001\u4e0a\u4e0b\u6587\u5207\u6362\u7b49\u573a\u666f\uff09\uff0c\u5206\u6790\u5176\u6210\u56e0\u53ca\u5229\u7528\u94fe\u6784\u9020\u65b9\u5f0f\u3002\uff08\u7efc\u8ff0\uff09</li> <li>\u6f0f\u6d1e\u590d\u73b0\u4e0e\u9a8c\u8bc1\uff1a\u642d\u5efa\u652f\u6301\u5b58\u5728\u6f0f\u6d1e\u7684Mali GPU\u9a71\u52a8\u7684\u865a\u62df\u673a\u5b9e\u9a8c\u73af\u5883\uff0c\u5e76\u4e14\u5728\u5b9e\u9a8c\u73af\u5883\u4e2d\u5c1d\u8bd5\u590d\u73b01-2\u4e2a\u6f0f\u6d1e\uff0c\u7ed3\u5408\u8c03\u8bd5\u5de5\u5177\uff08\u5982GDB\u3001\u5185\u6838\u65e5\u5fd7\u7b49\uff09\u89c2\u5bdfUAF\u89e6\u53d1\u65f6\u7684\u7cfb\u7edf\u884c\u4e3a\uff0c\u89e3\u91ca\u6f0f\u6d1e\u5982\u4f55\u901a\u8fc7GPU\u9a71\u52a8\u5f71\u54cd\u7269\u7406\u5185\u5b58\u6216\u5185\u6838\u5b8c\u6574\u6027\u3002\uff08\u5b9e\u73b0\uff09</li> </ol> <p>\u4e2d\u671f\uff08\u7b2c11\u5468\uff09\u5b8c\u6210\uff1a\u7efc\u8ff0  </p> <p>\u671f\u672b\uff08\u7b2c16\u5468\uff09\u5b8c\u6210\uff1a\u5b9e\u73b0</p> <p>\u53c2\u8003\u6587\u6863\uff1a</p> <ol> <li>GPU \u9a71\u52a8\u6f0f\u6d1e\uff1a\u7aa5\u63a2\u9a71\u52a8\u6f0f\u6d1e\u5229\u7528\u7684\u6280\u672f\u5965\u79d8</li> <li>Mali Open Source Driver</li> <li>GitHub Security Lab</li> <li>The \u201cnot-Google\u201d bug in the \u201call-Google\u201d phone</li> </ol>"},{"location":"proj/#9","title":"9.\u5206\u7ec4\u548c\u5c55\u793a","text":"<p>\u672c\u6b21final project\u91c7\u53d6\u81ea\u7531\u5206\u7ec4\uff0c\u6bcf\u7ec43\u4eba\u3002\u8bf7\u81ea\u884c\u7ec4\u961f\uff0c\u5e76\u4ece\u7ed9\u5b9a\u9898\u76ee\u4e2d\u9009\u62e9\u4e00\u4e2a\uff0c\u786e\u5b9a\u5206\u7ec4\u548c\u9009\u9898\u540e\uff0c3.30\u4e4b\u524d\u5c06\u7ec4\u5458\u540d\u5355\u548c\u9009\u9898\u586b\u5199\u81f3\u9489\u9489\u7fa4\u5171\u4eab\u6587\u4ef6\u3002</p> <p>\u6ce8\u610f\uff1a\u6bcf\u4e2a\u9898\u76ee\u6700\u591a2\u7ec4\u9009\u62e9\uff0c\u540c\u9009\u9898\u5c0f\u7ec4\u95f4\u9700\u534f\u5546\u786e\u5b9a\u4e0d\u540c\u7814\u7a76\u65b9\u5411\uff0c\u907f\u514d\u96f7\u540c\u3002</p> <p>\u5b9e\u9a8c\u8fc7\u7a0b\u4e2d\u5c06\u8bbe\u7f6e\u4e24\u6b21\u68c0\u67e5\uff1a</p> <ul> <li>\u4e2d\u671f\u68c0\u67e5\uff1a\u6839\u636e\u5404\u81ea\u9898\u76ee\u8981\u6c42\uff0c\u63d0\u4ea4\u8c03\u7814\u62a5\u544a\uff0c\u5c55\u793a\u8c03\u7814\u8fdb\u5c55\u3002</li> <li>\u671f\u672b\u68c0\u67e5\uff1a\u5206\u7ec4presentation\uff0c\u6bcf\u7ec4\u9650\u65f615min\uff0810min\u5c55\u793a+5min\u63d0\u95ee\uff09\uff0c\u8fdb\u884c\u8c03\u7814\u5185\u5bb9\u7684\u6c47\u62a5\u548c\u7ed3\u679c\u5c55\u793a\u3002\u5c55\u793a\u540e\u5728\u201c\u5b66\u5728\u6d59\u5927\u201d\u63d0\u4ea4PPT\u3002</li> </ul>"}]}